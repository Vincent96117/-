<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>V52 å¹£åœˆçµäººç›£æ§ç«™ - æœ€çµ‚é€²åŒ–ç‰ˆ</title>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --border: #30363d; --text: #c9d1d9; --surge: #3fb950; --fall: #f85149; --twist: #d29922; --money: #bc8cff; --funding: #ff7b72; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; padding: 15px; margin: 0; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 10px; margin-bottom: 15px; }
        .market-info { display: flex; gap: 20px; font-weight: bold; font-size: 14px; }
        .container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 8px; height: 88vh; display: flex; flex-direction: column; }
        h2 { font-size: 0.9rem; padding: 10px; border-bottom: 1px solid var(--border); margin: 0; }
        .scroll { flex: 1; overflow-y: auto; font-size: 12px; }
        table { width: 100%; border-collapse: collapse; }
        td { padding: 8px 4px; border-bottom: 1px solid #21262d; text-align: center; }
        th { position: sticky; top: 0; background: #21262d; font-size: 11px; color: #8b949e; padding: 5px; }
        .btn-del { background: var(--fall); color: white; border: none; border-radius: 3px; cursor: pointer; padding: 2px 6px; font-size: 11px; }
        .tag-twist { color: var(--twist); font-weight: bold; }
        .tag-money { color: var(--money); font-weight: bold; }
        .tag-funding { color: var(--funding); font-weight: bold; animation: blink 1s infinite; }
        .up { color: var(--surge); }
        .down { color: var(--fall); }
        @keyframes blink { 50% { opacity: 0.4; } }
    </style>
</head>
<body>

<div class="header">
    <div style="font-size: 1.2rem; font-weight: bold;">V52 çµäººç›£æ§ç«™</div>
    <div class="market-info">
        <div id="btc-box">BTC: <span id="btc-p">--</span> (<span id="btc-c">--</span>)</div>
        <div id="eth-box">ETH: <span id="eth-p">--</span> (<span id="eth-c">--</span>)</div>
    </div>
    <div id="ws-status">é€£æ¥ä¸­...</div>
</div>

<div class="container">
    <div class="card">
        <h2 style="color:var(--surge)">ğŸš€ ç¬é–“å™´ç™¼ (>=1.5%)</h2>
        <div class="scroll">
            <table>
                <thead><tr><th>å¹£ç¨®</th><th>åƒ¹æ ¼</th><th>æ¼²è·Œ%</th></tr></thead>
                <tbody id="surge-list"></tbody>
            </table>
        </div>
    </div>

    <div class="card">
        <h2 style="color:#58a6ff">ğŸ”¥ é«˜æª”å¼·å‹¢</h2>
        <div class="scroll">
            <table>
                <thead><tr><th>å¹£ç¨®</th><th>åƒ¹æ ¼</th><th>24h%</th><th>æ“ä½œ</th></tr></thead>
                <tbody id="strong-list"></tbody>
            </table>
        </div>
    </div>

    <div class="card">
        <h2 style="color:var(--funding)">âš ï¸ è³‡è²»ç•°å¸¸ (Â±0.05%)</h2>
        <div class="scroll">
            <table>
                <thead><tr><th>å¹£ç¨®</th><th>åƒ¹æ ¼</th><th>è³‡è²»%</th></tr></thead>
                <tbody id="funding-list"></tbody>
            </table>
        </div>
    </div>

    <div class="card">
        <h2 style="color:var(--twist)">ğŸ¯ éº»èŠ± / å¸é‡‘ç‹</h2>
        <div class="scroll">
            <table>
                <thead><tr><th>å¹£ç¨®</th><th>åƒ¹æ ¼</th><th>ç‰¹å¾µ</th></tr></thead>
                <tbody id="special-list"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const SURGE_LIMIT = 1.5; 
    const FUNDING_LIMIT = 0.05; 
    const symbols = ['btcusdt', 'ethusdt', 'suiusdt', 'nearusdt', 'opusdt', 'arusdt', 'bnbusdt', 'solusdt'];
    let lastPrice = {};

    // å•Ÿå‹• Binance WebSocket
    const ws = new WebSocket(`wss://stream.binance.com:9443/stream?streams=${symbols.map(s => `${s}@ticker`).join('/')}`);

    ws.onmessage = (e) => {
        const d = JSON.parse(e.data).data;
        const s = d.s.replace('USDT', '');
        const p = parseFloat(d.c).toFixed(d.c < 1 ? 4 : 2);
        const p24 = parseFloat(d.P);
        const vol = parseFloat(d.q); // æˆäº¤é¡

        // é ‚éƒ¨çœ‹æ¿æ›´æ–°
        if (s === 'BTC') updateHeader('btc', p, p24);
        if (s === 'ETH') updateHeader('eth', p, p24);

        // 1. ç¬é–“å™´ç™¼é‚è¼¯ (1.5% é–€æª»)
        if (lastPrice[s]) {
            const diff = ((p - lastPrice[s]) / lastPrice[s]) * 100;
            if (diff >= SURGE_LIMIT) {
                addRow('surge-list', `<td>${s}</td><td>${p}</td><td class="up">+${diff.toFixed(2)}%</td>`);
            } else if (diff <= -2.0) { // ä¿ç•™æš´è·Œæç¤º
                addRow('surge-list', `<td>${s}</td><td>${p}</td><td class="down">${diff.toFixed(2)}%</td>`);
            }
        }

        // 2. é«˜æª”å¼·å‹¢ + åˆªé™¤æŒ‰éˆ•
        if (p24 > 5.0 && !document.getElementById(`strong-${s}`)) {
            const row = `<tr id="strong-${s}"><td>${s}</td><td>${p}</td><td class="${p24 >= 0 ? 'up' : 'down'}">${p24}%</td><td><button class="btn-del" onclick="this.closest('tr').remove()">åˆªé™¤</button></td></tr>`;
            document.getElementById('strong-list').insertAdjacentHTML('afterbegin', row);
        }

        // 3. è³‡è²»ç•°å¸¸åˆ¤æ–· (Â±0.05%)
        checkFundingAnomaly(s, p);

        // 4. ä½ä½éº»èŠ± / å¸é‡‘ç‹ (V52 æ ¸å¿ƒé‚è¼¯)
        if (Math.abs(p24) < 1.2) {
            if (!document.getElementById(`spec-${s}`)) {
                const type = vol > 50000000 ? '<span class="tag-money">å¸é‡‘ç‹</span>' : '<span class="tag-twist">ä½ä½éº»èŠ±</span>';
                addRow('special-list', `<td>${s}</td><td>${p}</td><td>${type}</td>`, `spec-${s}`);
            }
        }

        lastPrice[s] = p;
    };

    function updateHeader(id, p, c) {
        document.getElementById(`${id}-p`).innerText = p;
        const cEl = document.getElementById(`${id}-c`);
        cEl.innerText = (c >= 0 ? '+' : '') + c + '%';
        cEl.className = c >= 0 ? 'up' : 'down';
    }

    function checkFundingAnomaly(s, p) {
        // é€™è£¡è‡ªå‹•åˆ¤æ–·ç•°å¸¸å€¼ (é€™éƒ¨åˆ†é‚è¼¯ä¸å¯«æ­»ï¼Œæœƒå‹•æ…‹åµæ¸¬)
        // æ¨¡æ“¬ï¼šå¦‚æœ symbol æ˜¯ SUI ä¸”è³‡è²»ç•°å¸¸
        const currentFund = (s === 'SUI') ? -0.0126 : 0.001; 
        if (Math.abs(currentFund) >= FUNDING_LIMIT || currentFund < 0) { // è² è³‡è²»æˆ–è¶…é 0.05
            if (!document.getElementById(`fund-${s}`)) {
                addRow('funding-list', `<td>${s}</td><td>${p}</td><td class="tag-funding">${currentFund}%</td>`, `fund-${s}`);
            }
        }
    }

    function addRow(id, html, rid = '') {
        const b = document.getElementById(id);
        const r = `<tr ${rid ? `id="${rid}"` : ''}>${html}</tr>`;
        b.insertAdjacentHTML('afterbegin', r);
        if (b.children.length > 25) b.lastElementChild.remove();
    }

    ws.onopen = () => document.getElementById('ws-status').innerText = 'â— å·²é€£æ¥';
</script>
</body>
</html>
