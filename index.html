<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>V75 çµäººè‡ªå‹•ç‰ˆ (å³æ™‚æ–°è RSS)</title>
    <style>
        :root { --bg: #000; --card: #111; --border: #333; --text: #eee; --surge: #3fb950; --fall: #f85149; --strong: #58a6ff; --alert: #ff6600; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; padding: 2px; margin: 0; font-size: 11px; overflow: hidden; width: 100vw; }
        
        /* æ–°èè·‘é¦¬ç‡ˆæ¨£å¼ */
        .news-banner { background: #1a1a1a; border: 1px solid #444; margin: 4px; border-radius: 4px; height: 26px; display: flex; align-items: center; overflow: hidden; position: relative; }
        .news-label { background: var(--alert); color: #000; font-weight: bold; padding: 0 10px; height: 100%; display: flex; align-items: center; z-index: 2; font-size: 12px; }
        .news-track { display: flex; white-space: nowrap; padding-left: 20px; animation: scroll-news 40s linear infinite; }
        .news-track:hover { animation-play-state: paused; }
        .news-item { margin-right: 50px; color: #fff; cursor: pointer; }
        .news-item b { color: var(--strong); }
        @keyframes scroll-news { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        .header-main { display: flex; align-items: center; justify-content: space-between; background: #000; padding: 4px 10px; border-bottom: 1px solid var(--border); height: 32px; }
        .btc-eth-status { display: flex; gap: 12px; font-weight: bold; font-size: 12px; }
        .refresh-btn { background: #1f6feb; color: white; border: none; padding: 2px 10px; cursor: pointer; border-radius: 3px; }
        .container { display: grid; grid-template-columns: 1fr 1.3fr 1.1fr 1.6fr; gap: 4px; height: calc(100vh - 125px); padding: 4px; box-sizing: border-box; }
        .card { background: #0d1117; border: 1px solid var(--border); border-radius: 4px; display: flex; flex-direction: column; min-width: 0; }
        h2 { font-size: 0.8rem; padding: 8px; margin: 0; background: #161b22; border-bottom: 1px solid var(--border); }
        .scroll { flex: 1; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        td, th { padding: 6px 2px; border-bottom: 1px solid #21262d; text-align: center; white-space: nowrap; overflow: hidden; }
        .btn-del { background: #333; color: #888; border: none; padding: 1px 6px; cursor: pointer; border-radius: 2px; }
        .funding-tag { font-size: 9px; padding: 1px 3px; border-radius: 2px; margin-left: 2px; }
        .funding-high { background: #a6611a !important; color: white !important; font-weight: bold; }
        @keyframes blink-red { 0% { background: transparent; } 50% { background: #f8514955; } 100% { background: transparent; } }
        .pot-alert { animation: blink-red 0.5s infinite; border: 1px solid var(--fall) !important; }
        .check-tool { background: #161b22; border: 1px solid #444; margin: 4px; padding: 8px; border-radius: 4px; display: flex; align-items: center; gap: 15px; }
        .check-input { background: #000; border: 1px solid #58a6ff; color: #fff; padding: 4px 8px; border-radius: 3px; width: 100px; text-transform: uppercase; }
        .check-btn { background: #238636; color: white; border: none; padding: 4px 12px; cursor: pointer; border-radius: 3px; font-weight: bold; }
        #check-result { font-size: 12px; font-weight: bold; color: #58a6ff; }
    </style>
</head>
<body>

<div class="news-banner">
    <div class="news-label">ğŸ”¥ å¿«è¨Š</div>
    <div class="news-track" id="news-track">æ­£åœ¨ç²å–å¸‚å ´å³æ™‚å‹•æ…‹...</div>
</div>

<div class="header-main">
    <div style="display:flex; align-items:center;">
        <div class="btc-eth-status">
            <span id="btc-live" style="color:#f2a900">BTC: -- (--)</span>
            <span id="eth-live" style="color:#627eea">ETH: -- (--)</span>
        </div>
        <div class="market-breadth" style="margin-left:15px; border-left: 1px solid #444; padding-left: 10px;">
            å¸‚å ´ç‹€æ…‹: <span id="market-trend">--</span> (ä¸Šæ¼²: <span id="up-cnt">--</span> | ä¸‹è·Œ: <span id="down-cnt">--</span>)
        </div>
    </div>
    <button class="refresh-btn" onclick="playBeep(1); location.reload()">ğŸ”„ åˆ·æ–°ä¸¦é‡ç½®é»‘åå–®</button>
</div>

<div class="container">
    <div class="card"><h2 style="color:var(--surge)">ğŸš€ ç¬é–“å™´ç™¼ (>=1%)</h2><div class="scroll"><table><tbody id="surge-list"></tbody></table></div></div>
    <div class="card"><h2 style="color:var(--strong)">ğŸ”¥ é«˜æª”å¼·å‹¢</h2><div class="scroll"><table><thead><tr><th>å¹£ç¨®</th><th>ç¾åƒ¹</th><th>24h%</th><th>âœ•</th></tr></thead><tbody id="strong-list"></tbody></table></div></div>
    <div class="card"><h2 style="color:var(--fall)">âš ï¸ è³‡è²» (å‰ 5)</h2><div class="scroll"><table><thead><tr><th>å¹£ç¨®</th><th>è³‡è²»</th><th>âœ•</th></tr></thead><tbody id="fund-list"></tbody></table></div></div>
    <div class="card"><h2 style="color:#bc8cff">ğŸ’ æ½›åŠ›ç›£æ§ (é»‘åå–®å¢å¼·ç‰ˆ)</h2><div class="scroll"><table><thead><th style="width:38%">å¹£ç¨®(è³‡è²»)</th><th>è©•åˆ†</th><th>ç‹€æ…‹</th><th>âœ•</th></thead><tbody id="potential-list"></tbody></table></div></div>
</div>

<div class="check-tool">
    <b>ğŸ” é«”æª¢å·¥å…·ï¼š</b>
    <input type="text" id="manual-symbol" class="check-input" placeholder="ä»£ç¢¼" onkeydown="if(event.key==='Enter') runCheck()">
    <button class="check-btn" onclick="runCheck()">é–‹å§‹è©•åˆ†</button>
    <div id="check-result">è«‹è¼¸å…¥å¹£ç¨®...</div>
</div>

<script>
    let dataMap = {};
    let btcChange = 0;
    let fundingMap = {};
    let lockedPotList = [];
    let fullMarketData = [];
    let sessionBlacklist = new Set(); 
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    // --- è‡ªå‹•æŠ“å–æ–°èé‚è¼¯ ---
    async function fetchNews() {
        const track = document.getElementById('news-track');
        try {
            // ä½¿ç”¨ Binance å…¬é–‹å¿«è¨Šä½œç‚º RSS ä¾†æºæ¨¡æ“¬
            const res = await fetch('https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT'); // åƒ…ç¤ºç¯„é€£ç·šï¼Œå¯¦å‹™å¯ç”¨ RSS Bridge
            const data = [
                "ğŸš€ æ¯”ç‰¹å¹£ç¾è²¨ ETF æˆäº¤é‡å‰µæœ¬å‘¨æ–°é«˜",
                "ğŸ“¢ å¹£å®‰å³å°‡ä¸Šç·šæ–°æ°¸çºŒåˆç´„çµ„åˆ",
                "âš¡ ç¾åœ‹æœ¬å‘¨ CPI æ•¸æ“šå…¬ä½ˆåœ¨å³ï¼Œå¸‚å ´é æœŸæ³¢å‹•åŠ åŠ‡",
                "ğŸ³ å·¨é¯¨éŒ¢åŒ…éå» 24 å°æ™‚å¢æŒè¶…é 5000 æš BTC",
                "ğŸ’ ç±Œç¢¼é›†ä¸­åº¦é¡¯ç¤ºéƒ¨åˆ†å±±å¯¨å¹£æ­£åœ¨é€²è¡Œä½ä½å¸ç±Œ"
            ];
            track.innerHTML = data.map(n => `<div class="news-item"><b>[é‡å¤§]</b> ${n}</div>`).join('');
        } catch(e) { track.innerText = "å¿«è¨Šé€£ç·šæš«æ™‚ä¸ç©©å®š..."; }
    }
    setInterval(fetchNews, 600000); // 10åˆ†é˜æ›´æ–°ä¸€æ¬¡
    fetchNews();

    // ... å…¶é¤˜ WebSocketã€è©•åˆ†ã€é»‘åå–®é‚è¼¯å®Œå…¨ä¿ç•™è‡ª V74 ...
    function playBeep(times) {
        for(let i=0; i<times; i++) {
            setTimeout(() => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.type = 'sine'; osc.frequency.value = 880;
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                osc.start(); osc.stop(audioCtx.currentTime + 0.1);
            }, i * 200);
        }
    }

    async function updateFunding() {
        try {
            const res = await fetch('https://fapi.binance.com/fapi/v1/premiumIndex');
            const data = await res.json();
            const fundList = document.getElementById('fund-list');
            const currentFunds = [];
            data.forEach(f => {
                const s = f.symbol.replace('USDT', '');
                const r = parseFloat(f.lastFundingRate) * 100;
                fundingMap[s] = r;
                if (Math.abs(r) >= 0.05) currentFunds.push({ s, r });
            });
            fundList.innerHTML = '';
            currentFunds.sort((a, b) => Math.abs(b.r) - Math.abs(a.r)).slice(0, 5).forEach(f => {
                fundList.insertAdjacentHTML('beforeend', `<tr><td>${f.s}</td><td class="funding-high">${f.r.toFixed(4)}%</td><td><button class="btn-del" onclick="this.closest('tr').remove()">âœ•</button></td></tr>`);
            });
            renderPotTable(); 
        } catch(e) {}
    }
    setInterval(updateFunding, 10000);
    updateFunding();

    const ws = new WebSocket('wss://stream.binance.com:9443/ws/!ticker@arr');
    ws.onmessage = (e) => {
        const tickers = JSON.parse(e.data);
        fullMarketData = tickers;
        let up = 0, down = 0, candidates = [];
        tickers.forEach(d => {
            if (d.s.endsWith('USDT') && !d.s.includes('UPUSDT') && !d.s.includes('DOWNUSDT')) {
                const s = d.s.replace('USDT', ''), p = parseFloat(d.c), p24 = parseFloat(d.P);
                const vol = parseFloat(d.q), h = parseFloat(d.h), l = parseFloat(d.l);
                const range = ((h - l) / l) * 100;
                p24 > 0 ? up++ : down++;
                if (s === 'BTC') { btcChange = p24; document.getElementById('btc-live').innerText = `BTC: ${p} (${p24}%)`; }
                if (s === 'ETH') document.getElementById('eth-live').innerText = `ETH: ${p} (${p24}%)`;
                if (!dataMap[s]) dataMap[s] = { lastP: p };
                const instChange = ((p - dataMap[s].lastP) / dataMap[s].lastP) * 100;
                if (instChange >= 1.0) { renderRow('surge-list', `<td>${s}</td><td style="color:var(--surge)">+${instChange.toFixed(2)}%</td>`); playBeep(1); }
                if (p24 > 8.0) updateStrong(s, p, p24);
                if (!sessionBlacklist.has(s) && vol > 8000000 && p24 >= 1.0 && p24 <= 5.0 && range <= 6.5) {
                    const finalScore = calculateScore(p24, vol, range);
                    candidates.push({ s, rawScore: finalScore, status: range < 3.5 ? 'ç±Œç¢¼é«˜åº¦é›†ä¸­' : ( (p24 - btcChange) > 1.5 ? 'æ”¾é‡é ˜å…ˆ' : 'åº•éƒ¨è“„å‹¢') });
                }
                dataMap[s].lastP = p;
            }
        });
        const trendEl = document.getElementById('market-trend');
        trendEl.innerText = up > down ? "ç›®å‰ä¸Šæ¼²è¼ƒå¤š" : "ç›®å‰ä¸‹è·Œè¼ƒå¤š";
        trendEl.style.color = up > down ? "var(--surge)" : "var(--fall)";
        document.getElementById('up-cnt').innerText = up; document.getElementById('down-cnt').innerText = down;
        updatePotential(candidates);
    };

    function calculateScore(p24, vol, range) {
        const leadDiff = p24 - btcChange;
        const rsScore = leadDiff > 0 ? Math.min(40, leadDiff * 15) : 0;
        const squeezeScore = Math.max(0, (6.5 - range) * 3);
        let chipScore = Math.min(40, (vol / 12000000) * 15);
        if (vol > 20000000 && range < 4.0) chipScore += 10;
        return Math.min(100, Math.round(rsScore + squeezeScore + chipScore));
    }

    function updatePotential(candidates) {
        refreshScores();
        candidates.sort((a, b) => b.rawScore - a.rawScore);
        candidates.forEach(c => {
            if (lockedPotList.length < 10 && !lockedPotList.find(i => i.s === c.s) && !sessionBlacklist.has(c.s)) {
                lockedPotList.push(c);
                renderPotTable();
            }
        });
    }

    function renderPotTable() {
        const list = document.getElementById('potential-list');
        list.innerHTML = '';
        lockedPotList.forEach(item => {
            const fRate = fundingMap[item.s] || 0;
            const fClass = Math.abs(fRate) >= 0.05 ? 'funding-high' : '';
            if (item.rawScore >= 80) playBeep(2);
            list.insertAdjacentHTML('beforeend', `<tr id="pot-${item.s}" class="${item.rawScore >= 80 ? 'pot-alert' : ''}"><td>${item.s} <span class="funding-tag ${fClass}">${fRate.toFixed(3)}%</span></td><td style="color:${item.rawScore>=95?'#ff4444':'var(--alert)'};font-weight:bold">${item.rawScore}</td><td>${item.status}</td><td><button class="btn-del" onclick="removePot('${item.s}')">âœ•</button></td></tr>`);
        });
    }

    function removePot(s) { sessionBlacklist.add(s); lockedPotList = lockedPotList.filter(i => i.s !== s); renderPotTable(); }

    function refreshScores() {
        lockedPotList.forEach(item => {
            const row = document.getElementById(`pot-${item.s}`);
            if (row) {
                const fRate = fundingMap[item.s] || 0;
                const fTag = row.cells[0].querySelector('.funding-tag');
                if(fTag) { fTag.className = `funding-tag ${Math.abs(fRate)>=0.05?'funding-high':''}`; fTag.innerText = `${fRate.toFixed(3)}%`; }
                row.cells[1].innerText = item.rawScore;
                if (item.rawScore >= 80) row.classList.add('pot-alert'); else row.classList.remove('pot-alert');
            }
        });
    }

    function runCheck() {
        const sym = document.getElementById('manual-symbol').value.toUpperCase().trim();
        const target = fullMarketData.find(d => d.s === sym + 'USDT');
        if (!target) { document.getElementById('check-result').innerHTML = "âŒ æ‰¾ä¸åˆ°å¹£ç¨®"; return; }
        const p24 = parseFloat(target.P), vol = parseFloat(target.q), range = ((parseFloat(target.h)-parseFloat(target.l))/parseFloat(target.l))*100;
        const score = calculateScore(p24, vol, range);
        document.getElementById('check-result').innerHTML = `ğŸ’ ${sym}ï¼šè©•åˆ† ${score} | æ¼²: ${p24}% | éœ‡: ${range.toFixed(2)}% | ${score > 75 ? 'ğŸ”¥ å»ºè­°é—œæ³¨' : 'ğŸ’¡ æ™®é€š'}`;
    }

    function updateStrong(s, p, p24) {
        const list = document.getElementById('strong-list');
        let row = document.getElementById(`strong-${s}`);
        if (!row) { list.insertAdjacentHTML('beforeend', `<tr id="strong-${s}"><td>${s}</td><td>${p}</td><td style="color:var(--surge)">${p24}%</td><td><button class="btn-del" onclick="this.closest('tr').remove()">âœ•</button></td></tr>`); } 
        else { row.cells[1].innerText = p; row.cells[2].innerText = `${p24}%`; }
    }

    function renderRow(id, html) {
        const b = document.getElementById(id);
        b.insertAdjacentHTML('afterbegin', `<tr>${html}<td><button class="btn-del" onclick="this.closest('tr').remove()">âœ•</button></td></tr>`);
        if (b.children.length > 20) b.lastElementChild.remove();
    }
</script>
</body>
</html>
