<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡èƒ½ç›£æ§-éˆæ•ç‰ˆ</title>
    <style>
        body { font-family: sans-serif; background: #0b0e11; color: #eaecef; padding: 15px; margin: 0; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #2b3139; padding-bottom: 15px; }
        .refresh-btn { background: #f0b90b; color: #000; border: none; padding: 12px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .grid { display: flex; gap: 15px; flex-direction: column; }
        @media (min-width: 992px) { .grid { flex-direction: row; } }
        .column { flex: 1; background: #181a20; padding: 15px; border-radius: 12px; border: 1px solid #2b3139; margin-top: 10px; }
        .col-title { color: #f0b90b; font-size: 18px; font-weight: bold; margin-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; color: #848e9c; font-size: 12px; border-bottom: 1px solid #2b3139; padding: 8px 5px; }
        td { padding: 10px 5px; border-bottom: 1px solid #2b3139; font-size: 14px; }
        .symbol { color: #f0b90b; font-weight: bold; }
        .up { color: #02c076; }
        .down { color: #f84960; }
    </style>
</head>
<body>
    <div class="header">
        <h1 style="margin:0; font-size: 20px;">ğŸ“Š å…¨å¸‚å ´ç›£æ§ (éˆæ•ç‰ˆ)</h1>
        <button id="btn" class="refresh-btn" onclick="run()">ğŸ”„ åˆ·æ–°</button>
    </div>
    <div id="status" style="text-align:center; color:#848e9c; margin: 10px 0;">æ’é™¤ä¸Šå¸‚ 3 å¤©å…§æ–°å¹£</div>
    <div class="grid">
        <div class="column">
            <div class="col-title">âš¡ çŸ­ç·šç•°å‹• (30M)</div>
            <table>
                <thead><tr><th>å¹£ç¨®</th><th>é‡æ¯”</th><th>æ¼²å¹…</th></tr></thead>
                <tbody id="sBody"></tbody>
            </table>
        </div>
        <div class="column">
            <div class="col-title">ğŸ“ˆ å¸¶é‡èµ·è·‘ (8H)</div>
            <table>
                <thead><tr><th>å¹£ç¨®</th><th>é‡æ¯”</th><th>æ¼²å¹…</th></tr></thead>
                <tbody id="lBody"></tbody>
            </table>
        </div>
    </div>
    <script>
        const sleep = ms => new Promise(res => setTimeout(res, ms));
        async function getData(s) {
            try {
                const [h, m, t] = await Promise.all([
                    fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=1h&limit=72`).then(r => r.json()),
                    fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=5m&limit=100`).then(r => r.json()),
                    fetch(`https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=${s}`).then(r => r.json())
                ]);
                if (h.length < 72) return null; // åªæ’é™¤ 3 å¤©å…§çš„æ–°å¹£

                const base = h.map(k => parseFloat(k[7])).reduce((a,b)=>a+b,0) / 72 / 12;
                const vols = m.map(k => parseFloat(k[7]));
                const chg = parseFloat(t.priceChangePercent);
                const rS = (vols.slice(-6).reduce((a,b)=>a+b,0)/6)/base;
                const rL = (vols.reduce((a,b)=>a+b,0)/100)/base;

                return { s, rS, rL, chg };
            } catch(e) { return null; }
        }
        async function run() {
            const btn = document.getElementById('btn'); btn.disabled = true;
            const status = document.getElementById('status');
            const info = await fetch('https://fapi.binance.com/fapi/v1/exchangeInfo').then(r => r.json());
            const list = info.symbols.filter(s => s.quoteAsset === 'USDT' && s.contractType === 'PERPETUAL').map(s => s.symbol);
            let sRes = [], lRes = [];
            for (let i = 0; i < list.length; i += 20) {
                status.innerText = `ğŸ” æƒæä¸­: ${Math.round(i/list.length*100)}%`;
                const batch = await Promise.all(list.slice(i, i + 20).map(s => getData(s)));
                batch.forEach(r => { 
                    if(r){ 
                        if(r.rS > 2.0) sRes.push(r); // é™ä½é–€æª»ï¼Œæ•æ‰æ›´å¤šæ©Ÿæœƒ
                        if(r.rL > 1.3 && r.chg > 0 && r.chg < 8) lRes.push(r); // å³é‚ŠæŠ“ã€Œé–‹å§‹å‹•äº†ã€ä¸”ã€Œæ¼²å¹…æœªéå¤§ã€çš„
                    } 
                });
                await sleep(50);
            }
            const fmt = (c) => `<span class="${c>=0?'up':'down'}">${c>=0?'+':''}${c.toFixed(2)}%</span>`;
            const render = (arr, key) => arr.sort((a,b)=>b[key]-a[key]).slice(0, 15).map(r => `<tr><td class="symbol">${r.s.replace('USDT','')}</td><td>${r[key].toFixed(1)}x</td><td>${fmt(r.chg)}</td></tr>`).join('');
            document.getElementById('sBody').innerHTML = render(sRes, 'rS') || "<tr><td colspan='3'>ç„¡è¨Šè™Ÿ</td></tr>";
            document.getElementById('lBody').innerHTML = render(lRes, 'rL') || "<tr><td colspan='3'>ç„¡è¨Šè™Ÿ</td></tr>";
            status.innerText = "âœ… æ›´æ–°æ™‚é–“: " + new Date().toLocaleTimeString();
            btn.disabled = false;
        }
        run();
    </script>
</body>
</html>
