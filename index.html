<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ V153 çµäººé›·é” (å°ˆæ¥­æ‹†è§£ç‰ˆ)</title>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --text: #c9d1d9; --blue: #58a6ff; --green: #238636; --orange: #d29922; --red: #da3633; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .control-panel { background: var(--card); padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #333; display: flex; align-items: center; gap: 10px; }
        input { background: #0d1117; border: 1px solid #444; color: #fff; padding: 8px; border-radius: 4px; flex-grow: 1; }
        .btn { padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-blue { background: var(--blue); color: #fff; }
        .btn-gray { background: #444; color: #fff; }
        .btn-red { background: var(--red); color: #fff; padding: 4px 8px; font-size: 12px; }
        table { width: 100%; border-collapse: collapse; background: var(--card); }
        th, td { padding: 12px; text-align: center; border-bottom: 1px solid #333; }
        th { color: var(--blue); background: #21262d; }
        .score-badge { padding: 5px 10px; border-radius: 4px; font-weight: bold; display: inline-block; min-width: 30px; }
        .high { background: var(--green); }
        .mid { background: var(--orange); color: #000; }
        .funding-highlight { color: #7ee787; font-weight: bold; background: rgba(35,134,54,0.2); padding: 2px 4px; border-radius: 3px; }
        #diag-box { background: #1c2128; border-left: 5px solid var(--blue); padding: 15px; margin-bottom: 20px; display: none; border-radius: 4px; }
        .diag-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px; }
        .diag-item { text-align: center; background: #0d1117; padding: 10px; border-radius: 4px; border: 1px solid #333; }
    </style>
</head>
<body>

<div class="control-panel">
    <input type="text" id="search-input" placeholder="è¼¸å…¥å¹£ç¨®æœå°‹è©³ç´°è©•åˆ† (å¦‚: BTC)">
    <button class="btn btn-blue" onclick="diagnoseSymbol()">ğŸ” è¨ºæ–·è©³ç´°æ•¸æ“š</button>
    <button class="btn btn-gray" onclick="resetBlacklist()">ğŸ”„ é‡è¨­åˆªé™¤åå–®</button>
</div>

<div id="diag-box"></div>

<table>
    <thead>
        <tr>
            <th>å¹£ç¨®</th>
            <th>æŠ€è¡“ç¸½åˆ† (100)</th>
            <th>è³‡è²» (åƒè€ƒ)</th>
            <th>è©•åˆ†ç´°é … (æ³¢/ç³¾/é‡/çª)</th>
            <th>ç®¡ç†</th>
        </tr>
    </thead>
    <tbody id="table-body"></tbody>
</table>

<script>
let blacklist = JSON.parse(localStorage.getItem('hunter_blacklist') || '[]');
const TRASH_LIST = ['USDC', 'FDUSD', 'TUSD', 'EUR', 'PAXG', 'AEUR', 'DAI', 'USDT'];
let lastData = [];

async function updateRadar() {
    try {
        const [tRes, fRes] = await Promise.all([
            fetch('https://fapi.binance.com/fapi/v1/ticker/24hr'),
            fetch('https://fapi.binance.com/fapi/v1/premiumIndex')
        ]);
        const tickers = await tRes.json();
        const fundings = await fRes.json();
        const fMap = {}; fundings.forEach(f => fMap[f.symbol] = parseFloat(f.lastFundingRate) * 100);

        lastData = tickers
            .filter(t => t.symbol.endsWith('USDT'))
            .map(t => {
                const sym = t.symbol.replace('USDT', '');
                if (TRASH_LIST.includes(sym) || blacklist.includes(sym)) return null;
                
                const price = parseFloat(t.lastPrice);
                const high = parseFloat(t.highPrice);
                const vwap = parseFloat(t.weightedAvgPrice);
                
                const s_vola = Math.min(25, Math.abs(parseFloat(t.priceChangePercent)) * 2);
                const s_volume = Math.min(25, (parseFloat(t.quoteVolume) / 300000000) * 25);
                const s_tangle = Math.max(0, 25 - (Math.abs(price - vwap) / vwap * 1000));
                const s_break = Math.min(25, (price / high) * 25);
                
                const score = Math.round(s_vola + s_volume + s_tangle + s_break);
                
                return { 
                    sym, score, 
                    funding: fMap[t.symbol] || 0,
                    vola: s_vola.toFixed(1),
                    tangle: s_tangle.toFixed(1),
                    volume: s_volume.toFixed(1),
                    breakout: s_break.toFixed(1)
                };
            })
            .filter(i => i && i.score >= 50) 
            .sort((a, b) => b.score - a.score);

        renderTable();
    } catch (e) { console.error(e); }
}

function renderTable() {
    const tbody = document.getElementById('table-body');
    tbody.innerHTML = '';
    lastData.slice(0, 40).forEach(item => {
        const isSpecial = Math.abs(item.funding) <= 0.05;
        const scoreClass = item.score >= 80 ? 'high' : (item.score >= 65 ? 'mid' : '');
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><b>${item.sym}</b></td>
            <td><span class="score-badge ${scoreClass}">${item.score}</span></td>
            <td><span class="${isSpecial?'funding-highlight':''}">${item.funding.toFixed(4)}%</span></td>
            <td style="font-size:12px; color:#8b949e">${item.vola} | ${item.tangle} | ${item.volume} | ${item.breakout}</td>
            <td><button class="btn-red" onclick="removeCoin('${item.sym}')">âœ•</button></td>
        `;
        tbody.appendChild(row);
    });
}

function diagnoseSymbol() {
    const inputSym = document.getElementById('search-input').value.toUpperCase().replace('USDT', '');
    const target = lastData.find(i => i.sym === inputSym);
    const box = document.getElementById('diag-box');
    
    if (!target) {
        box.style.display = 'block';
        box.innerHTML = `âŒ æ‰¾ä¸åˆ° <b>${inputSym}</b>ï¼Œå¯èƒ½æŠ€è¡“åˆ†éä½æœªä¸Šæ¦œæˆ–åç¨±æœ‰èª¤ã€‚`;
        return;
    }

    box.style.display = 'block';
    box.innerHTML = `
        <div style="font-weight:bold; font-size:1.1em; color:var(--blue)">ğŸ“Š ${target.sym} æŠ€è¡“è©³ç´°æ‹†è§£ï¼š</div>
        <div class="diag-grid">
            <div class="diag-item">æ³¢å‹•å¾—åˆ†<br><b style="color:var(--orange)">${target.vola}</b></div>
            <div class="diag-item">ç³¾çµå¾—åˆ†<br><b style="color:var(--orange)">${target.tangle}</b></div>
            <div class="diag-item">é‡èƒ½å¾—åˆ†<br><b style="color:var(--orange)">${target.volume}</b></div>
            <div class="diag-item">çªç ´å¾—åˆ†<br><b style="color:var(--orange)">${target.breakout}</b></div>
        </div>
        <div style="margin-top:10px; font-size:0.9em">ç¸½çµè©•åˆ†ï¼š<span class="score-badge ${target.score>=80?'high':'mid'}">${target.score}</span> (è³‡è²»: ${target.funding.toFixed(4)}%)</div>
    `;
}

function removeCoin(sym) {
    blacklist.push(sym);
    localStorage.setItem('hunter_blacklist', JSON.stringify(blacklist));
    updateRadar();
}

function resetBlacklist() {
    blacklist = [];
    localStorage.removeItem('hunter_blacklist');
    updateRadar();
}

setInterval(updateRadar, 15000);
updateRadar();
</script>
</body>
</html>
