<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>é‡èƒ½ç›£æ§ V45 - ç´¯è¨ˆæ¼²å¹…è¿½è¹¤</title>
    <style>
        body { font-family: sans-serif; background: #0b0e11; color: #eaecef; padding: 10px; margin: 0; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 10px; margin-top: 10px; }
        .column { background: #181a20; padding: 15px; border-radius: 12px; border: 1px solid #2b3139; min-height: 580px; }
        .col-title { color: #f0b90b; font-size: 16px; font-weight: bold; margin-bottom: 5px; }
        table { width: 100%; border-collapse: collapse; }
        td { padding: 8px 5px; border-bottom: 1px solid #2b3139; font-size: 13px; }
        .symbol { color: #f0b90b; font-weight: bold; font-size: 14px; }
        .up { color: #02c076; font-weight: bold; }
        .down { color: #f84960; }
        .tag { padding: 2px 4px; border-radius: 4px; font-size: 10px; font-weight: bold; }
        .tag-strong { background: rgba(2, 192, 118, 0.2); color: #02c076; }
        .tag-awake { background: rgba(240, 185, 11, 0.2); color: #f0b90b; }
        .accum-up { background: #02c076; color: #fff; padding: 1px 3px; border-radius: 3px; font-size: 11px; }
    </style>
</head>
<body>
    <div style="display:flex; justify-content:space-between; padding:10px;">
        <h2 style="margin:0; font-size: 18px;">ğŸ“Š å°ˆæ¥­ç›£æ§ V45 (è‡ªç™¼ç¾èµ·ç´¯è¨ˆæ¼²å¹…)</h2>
        <div id="timer" style="color:#848e9c;">5s åˆ·æ–°</div>
    </div>
    
    <div class="grid">
        <div class="column">
            <div class="col-title">âš¡ ç¬é–“å™´ç™¼ (ç´¯è¨ˆè¿½è¹¤)</div>
            <table><tbody id="instantBody"></tbody></table>
        </div>
        <div class="column">
            <div class="col-title">ğŸ”¥ é«˜æª”å¼·å‹¢ (æ’ä½ 5%)</div>
            <table><tbody id="trendBody"></tbody></table>
        </div>
        <div class="column">
            <div class="col-title">ğŸ“ˆ ç›¤æ•´é‡å¢ (2Hé€±æœŸ)</div>
            <table><tbody id="sidewaysBody"></tbody></table>
        </div>
    </div>

    <audio id="alertSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

    <script>
        let lastPrices = new Map(); 
        let firstDetectedPrices = new Map(); // ç´€éŒ„å·¦æ¬„æ¨™çš„ç¬¬ä¸€æ¬¡å‡ºç¾çš„åƒ¹æ ¼
        let burstHistory = []; 
        let timeLeft = 5;

        async function run() {
            try {
                const resp = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr');
                const tickers = await resp.json();
                let trendRes = [], awakeRes = [];
                let now = Date.now();

                tickers.filter(t => t.symbol.endsWith('USDT') && !t.symbol.includes('_')).forEach(t => {
                    const symbol = t.symbol.replace('USDT', '');
                    const curPrice = parseFloat(t.lastPrice);
                    const vol24h = parseFloat(t.quoteVolume);
                    const chg24h = parseFloat(t.priceChangePercent);
                    const high = parseFloat(t.highPrice), low = parseFloat(t.lowPrice);
                    const swing = (high - low) / low;
                    
                    // 1. å·¦æ¬„ï¼š5ç§’åƒ¹å·®
                    let secChange = 0;
                    if (lastPrices.has(symbol)) {
                        secChange = ((curPrice - lastPrices.get(symbol)) / lastPrices.get(symbol)) * 100;
                    }
                    lastPrices.set(symbol, curPrice);

                    // 2. é‡èƒ½å°æ¯” (ç›®å‰ 2H æ¨¡æ“¬é‡ vs 24H å¹³å‡)
                    const realBurst = (vol24h / 450) / (vol24h / 1440);

                    // --- æ ¸å¿ƒé‚è¼¯åˆ¤å®š ---

                    // å·¦ï¼šç¬é–“å™´ç™¼
                    if (secChange >= 0.45 && vol24h > 5000000) {
                        // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å‡ºç¾åœ¨å·¦æ¬„ï¼Œè¨˜éŒ„èµ·å§‹åƒ¹æ ¼
                        if (!firstDetectedPrices.has(symbol)) {
                            firstDetectedPrices.set(symbol, curPrice);
                        }
                        
                        burstHistory = burstHistory.filter(item => item.s !== symbol);
                        burstHistory.unshift({ s: symbol, c: secChange, ts: now });
                        if (burstHistory.length > 10) burstHistory.pop();
                        document.getElementById('alertSound').play().catch(()=>{});
                    } 

                    // ä¸­ï¼šé«˜æª”å¼·å‹¢ (æ¼²å¹… > 5% ä¸”æ’åœ¨æœ€é«˜é» 1.5% å…§)
                    if (chg24h > 5.0 && (high - curPrice)/high < 0.015) {
                        trendRes.push({ s: symbol, c: chg24h });
                    }

                    // å³ï¼šç›¤æ•´é‡å¢ (2H é€±æœŸç”¦é†’ï¼Œç¢ºä¿æ²’å™´å‡º)
                    // åƒ¹æ ¼çµ•å°æ¼²è·Œ < 2.5%, ä¸” 2H é‡èƒ½æŠ¬å‡ 1.3x~2.8x
                    if (Math.abs(chg24h) < 2.5 && swing < 0.18 && realBurst > 1.3 && realBurst < 2.8) {
                        awakeRes.push({ s: symbol, b: realBurst });
                    }
                });

                // æ¸²æŸ“å·¦æ¬„ (å«ç´¯è¨ˆæ¼²å¹…è¨ˆç®—)
                document.getElementById('instantBody').innerHTML = burstHistory.map(r => {
                    const startPrice = firstDetectedPrices.get(r.s) || 0;
                    const curPrice = lastPrices.get(r.s) || 0;
                    const accumChg = startPrice > 0 ? ((curPrice - startPrice) / startPrice * 100) : 0;
                    return `<tr>
                        <td><span class="symbol">${r.s}</span><br><span style="font-size:10px; color:#848e9c;">${Math.floor((Date.now()-r.ts)/1000)}så‰åµæ¸¬</span></td>
                        <td class="up" align="right">+${r.c.toFixed(2)}%</td>
                        <td align="right"><span class="accum-up">çºŒæ¼²:${accumChg.toFixed(2)}%</span></td>
                    </tr>`;
                }).join('');

                // æ¸²æŸ“ä¸­æ¬„
                document.getElementById('trendBody').innerHTML = trendRes.sort((a,b)=>b.c-a.c).slice(0,10).map(r => `<tr><td class="symbol">${r.s}</td><td><span class="tag tag-strong">é«˜æª”æ©«ç›¤</span></td><td class="up" align="right">+${r.c.toFixed(1)}%</td></tr>`).join('');

                // æ¸²æŸ“å³æ¬„
                document.getElementById('sidewaysBody').innerHTML = awakeRes.sort((a,b)=>b.b-a.b).slice(0,10).map(r => `<tr><td class="symbol">${r.s}</td><td><span class="tag tag-awake">2Hé‡èƒ½æŠ¬å‡</span></td><td align="right">${r.b.toFixed(1)}x é‡</td></tr>`).join('');
                
            } catch (e) { console.error(e); }
        }

        setInterval(() => { if (--timeLeft <= 0) { timeLeft=5; run(); } document.getElementById('timer').innerText = timeLeft + "s åˆ·æ–°"; }, 1000);
        run();
    </script>
</body>
</html>
