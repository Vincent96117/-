<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>HUNTER V163 | ä¸»æµå¹£éæ¿¾ç‰ˆ</title>
    <style>
        body { background: #0b0e11; color: #eee; font-family: 'Segoe UI', sans-serif; padding: 0 20px 20px 20px; margin: 0; }
        .header { display: flex; justify-content: space-between; align-items: center; background: #181a20; padding: 15px 20px; border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 100; }
        
        /* å¤§å¹£å„€è¡¨æ¿ - è®Šçª„ä»¥å®¹ç´æ›´å¤š */
        .market-watch { display: flex; gap: 15px; background: #1e2329; padding: 8px 20px; border-bottom: 1px solid #333; flex-wrap: wrap; }
        .watch-item { display: flex; align-items: center; gap: 6px; font-family: 'Roboto Mono', monospace; border-right: 1px solid #333; padding-right: 15px; }
        .watch-label { color: #f0b90b; font-size: 12px; font-weight: bold; }
        .watch-price { color: #fff; font-size: 13px; }
        .watch-change { font-size: 11px; }

        .controls { display: flex; gap: 10px; align-items: center; }
        input { background: #2b2f36; border: 2px solid #444; color: #fff; padding: 8px 15px; border-radius: 5px; width: 220px; }
        input:focus { border-color: #f0b90b; outline: none; }
        
        table { width: 100%; border-collapse: collapse; background: #181a20; margin-top: 10px; }
        th, td { padding: 12px; text-align: center; border-bottom: 1px solid #2b2f36; }
        th { background: #2b2f36; color: #848e9c; font-size: 13px; }
        
        .row-tangling { background: rgba(0, 192, 135, 0.08) !important; border-left: 4px solid #00c087; }
        .lv-high { color: #f6465d; font-weight: bold; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.4; } }
        
        .score-box { background: #2b3139; color: #f0b90b; padding: 5px 12px; border-radius: 4px; font-weight: bold; font-size: 16px; border: 1px solid #444; }
        .score-detail { font-size: 11px; color: #848e9c; margin-top: 6px; display: flex; gap: 5px; justify-content: center; }
        .high-impact { color: #f0b90b; font-weight: bold; }
        
        .btn { border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .up { color: #00c087; } .down { color: #f6465d; }
        .btn-del { background: transparent; color: #666; font-size: 18px; cursor: pointer; border: none; }
    </style>
</head>
<body>
    <div class="header">
        <div><span style="font-size: 24px; font-weight: bold; color: #f0b90b;">ğŸ¯ V163 çµäººé›·é”</span></div>
        <div class="controls">
            <input type="text" id="searchInput" placeholder="ç‹™æ“Šå¹£ç¨® (å¦‚: PEPE)..." oninput="startScan()">
            <button id="btn-sound" class="btn" style="background:#2b3139; color:#fff;" onclick="toggleSound()">ğŸ”Š è²éŸ³: é–‹</button>
            <button id="btn-toggle" class="btn" style="background:#f0b90b; color:#000;" onclick="toggleMonitor()">ğŸ“¡ å•Ÿå‹•æƒæ</button>
        </div>
    </div>

    <div class="market-watch" id="market-watch">
        </div>

    <table>
        <thead>
            <tr>
                <th>é¡å‹</th>
                <th>å¹£ç¨®èˆ‡é›™ TP (2.8x)</th>
                <th>ğŸš€ åŠ é€Ÿç­‰ç´š</th>
                <th>æŠ€è¡“ç¸½åˆ† (æ³¢|ç³¾|é‡|å‹¢)</th>
                <th>è³‡è²» (Â±0.05å„ªå…ˆ)</th>
                <th>24H æ¼²è·Œ</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody id="list-body"></tbody>
    </table>

<script>
    let isMonitoring = false, isSoundOn = true, allData = [], timer = null, blackList = new Set();
    
    // å®šç¾©ã€Œå¤§å¹£/ä¸»æµå¹£ã€é»‘åå–®ï¼Œé€™äº›å¹£ä¸é€²ä¸‹æ–¹åˆ—è¡¨
    const mainStreamCoins = [
        'BTCUSDT', 'ETHUSDT', 'SOLUSDT', 'BNBUSDT', 'ADAUSDT', 
        'XRPUSDT', 'DOGEUSDT', 'TRXUSDT', 'DOTUSDT', 'LINKUSDT', 
        'AVAXUSDT', 'MATICUSDT', 'LTCUSDT', 'BCHUSDT', 'SHIBUSDT'
    ];

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function toggleSound() { isSoundOn = !isSoundOn; document.getElementById('btn-sound').innerText = isSoundOn ? "ğŸ”Š è²éŸ³: é–‹" : "ğŸ”‡ è²éŸ³: é—œ"; }
    function playBeep() { if (!isSoundOn) return; const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.frequency.setValueAtTime(1000, audioCtx.currentTime); gain.gain.setValueAtTime(0.1, audioCtx.currentTime); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.15); }
    
    function toggleMonitor() {
        isMonitoring = !isMonitoring;
        document.getElementById('btn-toggle').innerText = isMonitoring ? "ğŸ›‘ åœæ­¢ç›£æ§" : "ğŸ“¡ å•Ÿå‹•æƒæ";
        document.getElementById('btn-toggle').style.background = isMonitoring ? "#f6465d" : "#f0b90b";
        if(isMonitoring) { startScan(); timer = setInterval(startScan, 15000); } else { clearInterval(timer); }
    }
    
    function removeSymbol(s) { blackList.add(s); renderTable(); }

    async function updateMarketWatch() {
        try {
            // åªæŠ“å‰ 6 åå¤§å¹£æ”¾å„€è¡¨æ¿
            const watchList = mainStreamCoins.slice(0, 6);
            const results = await Promise.all(watchList.map(s => fetch(`https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=${s}`).then(r=>r.json())));
            document.getElementById('market-watch').innerHTML = results.map(r => `
                <div class="watch-item">
                    <span class="watch-label">${r.symbol.replace('USDT','')}</span>
                    <span class="watch-price">${parseFloat(r.lastPrice).toLocaleString()}</span>
                    <span class="watch-change ${parseFloat(r.priceChangePercent) >= 0 ? 'up' : 'down'}">
                        ${r.priceChangePercent}%
                    </span>
                </div>
            `).join('');
        } catch(e) {}
    }

    async function getSymbolData(s) {
        try {
            const sym = s.toUpperCase().endsWith('USDT') ? s.toUpperCase() : s.toUpperCase() + 'USDT';
            const [tData, fRes, hK, mK] = await Promise.all([
                fetch(`https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=${sym}`).then(r=>r.json()),
                fetch(`https://fapi.binance.com/fapi/v1/premiumIndex?symbol=${sym}`).then(r=>r.json()),
                fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${sym}&interval=1h&limit=121`).then(r=>r.json()),
                fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${sym}&interval=1m&limit=30`).then(r=>r.json())
            ]);
            if (!tData.symbol) return null;

            const now = parseFloat(hK[hK.length-1][4]);
            const hRanges = hK.map(k => parseFloat(k[2]) - parseFloat(k[3]));
            const atr1d = hRanges.slice(-25, -1).reduce((a,b)=>a+b,0) / 24;
            const hCloses = hK.map(k=>parseFloat(k[4]));
            const ma7 = hCloses.slice(-7).reduce((a,b)=>a+b,0)/7;
            const ma25 = hCloses.slice(-25).reduce((a,b)=>a+b,0)/25;
            
            const s1 = Math.min(25, (hRanges[hRanges.length-1]/atr1d/1.8)*25);
            const s2 = (Math.abs(ma7-ma25)/ma25*100 < 3) ? 25 : 0;
            const s3 = Math.min(25, (parseFloat(tData.quoteVolume)/45000000)*12.5);
            const s4 = (now > ma7 && ma7 > ma25) ? 25 : 0;

            const curVol = parseFloat(mK[mK.length-1][5]);
            const avgVol = mK.reduce((a,b)=>a+parseFloat(b[5]),0) / mK.length;
            const vRatio = curVol / avgVol;
            let thrustLv = Math.floor(Math.min(10, vRatio > 1 ? vRatio * 1.5 : 1));
            
            const funding = parseFloat(fRes.lastFundingRate * 100);
            const isTangling = (funding >= -0.05 && funding <= 0.05);
            if (isMonitoring && thrustLv >= 8 && isTangling) playBeep();

            return { s: sym, s1, s2, s3, s4, totalScore: Math.round(s1+s2+s3+s4), thrustLv, vRatio: vRatio.toFixed(1), 
                     tp1d: ((atr1d*2.8)/now*100).toFixed(1), tp5d: (((hRanges.slice(-121, -1).reduce((a,b)=>a+b,0)/120)*2.8)/now*100).toFixed(1), 
                     sl: ((atr1d*2.2)/now*100).toFixed(1), funding, change: tData.priceChangePercent, isTangling };
        } catch(e) { return null; }
    }

    async function startScan() {
        updateMarketWatch();
        const query = document.getElementById('searchInput').value.trim().toUpperCase();
        const tRes = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr');
        const tData = await tRes.json();
        
        // æ ¸å¿ƒé‚è¼¯ï¼šéæ¿¾ä¸»æµå¹£èˆ‡æˆäº¤é‡éä½çš„å¹£
        let symbols = tData.filter(d => d.symbol.endsWith('USDT') && 
                                        parseFloat(d.quoteVolume) > 30000000 && 
                                        !mainStreamCoins.includes(d.symbol)) // è‡ªå‹•éæ¿¾ä¸»æµå¹£
                           .sort((a,b)=>b.quoteVolume-a.quoteVolume).slice(0, 45).map(d => d.symbol);

        if (query) {
            const searchSym = query.endsWith('USDT') ? query : query + 'USDT';
            if (!symbols.includes(searchSym)) symbols.unshift(searchSym);
        }

        let results = [];
        for (let s of symbols) { 
            if (blackList.has(s)) continue;
            const res = await getSymbolData(s); 
            if (res) results.push(res); 
        }
        allData = results.sort((a,b) => {
            if(query) {
                const q = query.endsWith('USDT') ? query : query + 'USDT';
                if(a.s === q) return -1;
                if(b.s === q) return 1;
            }
            return (a.isTangling === b.isTangling) ? (b.totalScore - a.totalScore) : (a.isTangling ? -1 : 1);
        });
        renderTable();
    }

    function renderTable() {
        document.getElementById('list-body').innerHTML = allData.map(r => `
            <tr class="${r.isTangling ? 'row-tangling' : ''}">
                <td style="color:${r.isTangling ? '#00c087' : '#848e9c'}">${r.isTangling ? 'ğŸ’ ç³¾çµ' : 'ğŸ“Š è¶¨å‹¢'}</td>
                <td>
                    <div style="font-weight:bold; font-size:16px; color:#fff;">${r.s.replace('USDT','')}</div>
                    <div style="font-size:11px; margin-top:4px;">
                        <span style="color:#00c087">1D:ğŸ¯${r.tp1d}%</span> | <span style="color:#f0b90b">5D:ğŸ¯${r.tp5d}%</span> | <span style="color:#f6465d">SL:-${r.sl}%</span>
                    </div>
                </td>
                <td class="${r.thrustLv >= 8 ? 'lv-high' : ''}">LV ${r.thrustLv} <small>(${r.vRatio}x)</small></td>
                <td>
                    <span class="score-box">${r.totalScore}</span>
                    <div class="score-detail">
                        <span class="${r.s1>=20?'high-impact':''}"><b>æ³¢</b>:${Math.round(r.s1)}</span>
                        <span class="${r.s2>=20?'high-impact':''}"><b>ç³¾</b>:${Math.round(r.s2)}</span>
                        <span class="${r.s3>=20?'high-impact':''}"><b>é‡</b>:${Math.round(r.s3)}</span>
                        <span class="${r.s4>=20?'high-impact':''}"><b>å‹¢</b>:${Math.round(r.s4)}</span>
                    </div>
                </td>
                <td style="color:${r.isTangling ? '#00c087' : '#eee'}; font-weight:bold;">${r.funding.toFixed(4)}%</td>
                <td style="color:${parseFloat(r.change)>=0?'#00c087':'#f6465d'}">${r.change}%</td>
                <td><button class="btn-del" onclick="removeSymbol('${r.s}')">âŒ</button></td>
            </tr>
        `).join('');
    }
    
    updateMarketWatch();
</script>
</body>
</html>
