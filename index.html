<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>HUNTER V155 | å¤§ç›¤é€£å‹•ç‰ˆ</title>
    <style>
        body { background: #000; color: #eee; font-family: 'Segoe UI', sans-serif; padding: 10px; font-size: 13px; }
        /* é ‚éƒ¨é»‘è‰²ç›£æ§å€ */
        .header { background: #111; padding: 15px; border-radius: 8px; border: 1px solid #333; margin-bottom: 15px; }
        .monitor-bar { display: flex; gap: 20px; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 1px solid #222; }
        .index-item { display: flex; align-items: center; gap: 8px; }
        .index-name { color: #f2a900; font-weight: bold; font-size: 14px; }
        .index-price { font-family: 'Courier New', monospace; font-size: 16px; font-weight: bold; }
        
        .controls { display: flex; justify-content: space-between; align-items: center; }
        .search-group { display: flex; gap: 10px; }
        
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #333; padding: 10px; text-align: center; }
        th { background: #252525; color: #f2a900; }
        .row-tangling { background: rgba(0, 255, 204, 0.1) !important; border-left: 4px solid #00ffcc; }
        .lv-high { color: #ff4444; font-weight: bold; text-shadow: 0 0 8px #ff4444; animation: blink 0.8s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
        .score-box { background: #444; color: #fff; padding: 3px 8px; border-radius: 3px; font-weight: bold; }
        .info-tag { font-size: 10px; color: #888; display: block; }
        .btn { border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        input { background: #222; border: 1px solid #444; color: #fff; padding: 6px; border-radius: 4px; width: 150px; }
        .del-btn { color: #ff4444; cursor: pointer; font-weight: bold; padding: 0 5px; }
    </style>
</head>
<body>
    <div class="header">
        <div class="monitor-bar" id="market-bar">
            <div class="index-item">
                <span class="index-name">BTC:</span>
                <span id="btc-price" class="index-price">--</span>
                <span id="btc-chg" style="font-size:12px;">--</span>
            </div>
            <div class="index-item">
                <span class="index-name">ETH:</span>
                <span id="eth-price" class="index-price">--</span>
                <span id="eth-chg" style="font-size:12px;">--</span>
            </div>
            <div style="margin-left:auto; color:#666; font-size:12px;">ğŸ“¡ è¨Šè™Ÿé€£å‹•ä¸­...</div>
        </div>

        <div class="controls">
            <div class="search-group">
                <input type="text" id="search-input" placeholder="ğŸ” æœå°‹å¹£ç¨®..." oninput="renderTable()">
                <button id="btn-sound" class="btn" onclick="toggleSound()" style="background:#333;color:#fff;">ğŸ”Š è²éŸ³: é–‹</button>
            </div>
            <button id="btn-toggle" class="btn" onclick="toggleMonitor()" style="background:#f2a900;color:#000;">å•Ÿå‹•ç›£æ§æƒæ</button>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>æ“ä½œ</th>
                <th>é¡å‹</th>
                <th>å¹£ç¨®èˆ‡å€é–“</th>
                <th>ğŸš€ è¡åˆºç­‰ç´š (é€Ÿåº¦/ä¸»å‹•è²·)</th>
                <th>æŠ€è¡“ç¸½åˆ†</th>
                <th>è³‡è²» (Â±0.05)</th>
                <th>24H æ¼²è·Œ</th>
            </tr>
        </thead>
        <tbody id="list-body"></tbody>
    </table>

<script>
    let isMonitoring = false, isSoundOn = true, timer = null, marketTimer = null;
    let rawResults = []; 
    let blackList = new Set();
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function toggleSound() { isSoundOn = !isSoundOn; document.getElementById('btn-sound').innerText = isSoundOn ? "ğŸ”Š è²éŸ³: é–‹" : "ğŸ”‡ è²éŸ³: é—œ"; }
    function playBeep() {
        if (!isSoundOn) return;
        const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
        osc.frequency.setValueAtTime(1000, audioCtx.currentTime); gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + 0.1);
    }

    async function updateMarketIndex() {
        try {
            const res = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr?symbols=["BTCUSDT","ETHUSDT"]');
            const data = await res.json();
            data.forEach(coin => {
                const s = coin.symbol.replace('USDT','').toLowerCase();
                const price = parseFloat(coin.lastPrice).toLocaleString();
                const chg = parseFloat(coin.priceChangePercent).toFixed(2);
                const color = chg >= 0 ? '#00ffcc' : '#ff4444';
                document.getElementById(`${s}-price`).innerText = price;
                document.getElementById(`${s}-chg`).innerText = `${chg}%`;
                document.getElementById(`${s}-chg`).style.color = color;
            });
        } catch(e) {}
    }
    // ç¨ç«‹æ–¼æƒæï¼Œæ¯3ç§’æ›´æ–°ä¸€æ¬¡å¤§ç›¤
    setInterval(updateMarketIndex, 3000);

    function toggleMonitor() {
        isMonitoring = !isMonitoring;
        document.getElementById('btn-toggle').innerText = isMonitoring ? "ğŸ›‘ åœæ­¢ç›£æ§" : "å•Ÿå‹•ç›£æ§æƒæ";
        document.getElementById('btn-toggle').style.background = isMonitoring ? "#ff4444" : "#f2a900";
        if(isMonitoring) { startScan(); timer = setInterval(startScan, 15000); } else { clearInterval(timer); }
    }

    function removeSymbol(s) { blackList.add(s); renderTable(); }

    async function getSymbolData(s) {
        try {
            const [tData, fRes, hK, mK] = await Promise.all([
                fetch(`https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=${s}`).then(r=>r.json()),
                fetch(`https://fapi.binance.com/fapi/v1/premiumIndex?symbol=${s}`).then(r=>r.json()),
                fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=1h&limit=25`).then(r=>r.json()),
                fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=1m&limit=60`).then(r=>r.json())
            ]);
            
            const now = parseFloat(hK[24][4]);
            const hCloses = hK.map(k=>parseFloat(k[4]));
            const ma7 = hCloses.slice(-7).reduce((a,b)=>a+b,0)/7;
            const ma25 = hCloses.slice(-25).reduce((a,b)=>a+b,0)/25;
            const ranges = hK.map(k => parseFloat(k[2]) - parseFloat(k[3]));
            const avgR = (ranges.slice(0, 24).reduce((a,b)=>a+b,0) / 24) || 0.001;

            const score1 = Math.min(25, ((parseFloat(hK[24][2]) - parseFloat(hK[24][3]))/avgR/1.8)*25);
            const score2 = (Math.abs(ma7-ma25)/ma25*100 < 3) ? 25 : 0;
            const score3 = Math.min(25, (parseFloat(tData.quoteVolume)/45000000)*12.5);
            const score4 = (now > ma7 && ma7 > ma25) ? 25 : 0;
            const totalScore = Math.round(score1 + score2 + score3 + score4);

            const totalVol1m = parseFloat(mK[59][5]);
            const takerVol1m = parseFloat(mK[59][9]);
            const avgVol1m = mK.reduce((a,b)=>a+parseFloat(b[5]),0) / 60;
            const vRatio = totalVol1m / avgVol1m; 
            const buyRatio = (takerVol1m / totalVol1m) * 100;

            let combinedScore = (vRatio * 1.5); 
            if (buyRatio > 65) combinedScore += 4;      
            else if (buyRatio < 50) combinedScore -= 3; 
            let thrustLv = Math.max(1, Math.min(10, Math.round(combinedScore)));

            const funding = parseFloat(fRes.lastFundingRate * 100);
            const isTangling = (funding >= -0.05 && funding <= 0.05);
            if (isMonitoring && thrustLv >= 8 && isTangling) playBeep();

            return { 
                s, totalScore, thrustLv, vRatio: vRatio.toFixed(1), buyRatio: buyRatio.toFixed(0),
                tp: ((avgR/now)*100*2.8).toFixed(1), sl: ((avgR/now)*100*2.2).toFixed(1),
                funding, change: tData.priceChangePercent, isTangling 
            };
        } catch(e) { return null; }
    }

    async function startScan() {
        const tRes = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr');
        const tData = await tRes.json();
        let baseSymbols = tData.filter(d => d.symbol.endsWith('USDT') && parseFloat(d.quoteVolume) > 30000000).slice(0, 35);
        
        let results = [];
        for (let d of baseSymbols) {
            if(blackList.has(d.symbol)) continue;
            const res = await getSymbolData(d.symbol);
            if (res && res.totalScore > 30) results.push(res);
        }
        rawResults = results;
        renderTable();
    }

    function renderTable() {
        const keyword = document.getElementById('search-input').value.toUpperCase();
        const filtered = rawResults.filter(r => r.s.includes(keyword));
        filtered.sort((a, b) => (a.isTangling === b.isTangling) ? (b.totalScore - a.totalScore) : (a.isTangling ? -1 : 1));

        document.getElementById('list-body').innerHTML = filtered.map(r => `
            <tr class="${r.isTangling ? 'row-tangling' : ''}">
                <td><span class="del-btn" onclick="removeSymbol('${r.s}')">âœ•</span></td>
                <td>${r.isTangling ? 'ğŸ’ ç³¾çµ' : 'ğŸ“Š è¶¨å‹¢'}</td>
                <td style="font-weight:bold;">${r.s.replace('USDT','')}<span class="info-tag">ğŸ¯ ${r.tp}% / -${r.sl}%</span></td>
                <td class="${r.thrustLv >= 8 ? 'lv-high' : ''}">
                    LV ${r.thrustLv}
                    <span class="info-tag">${r.vRatio}x / ${r.buyRatio}%</span>
                </td>
                <td><span class="score-box">${r.totalScore}</span></td>
                <td style="color:${r.isTangling ? '#00ffcc' : '#eee'}">${r.funding.toFixed(4)}%</td>
                <td style="color:#00ffcc">${r.change}%</td>
            </tr>
        `).join('');
    }
    updateMarketIndex();
</script>
</body>
</html>
