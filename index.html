<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡èƒ½ç›£æ§-æ¥µé€Ÿç‰ˆ</title>
    <style>
        body { font-family: sans-serif; background: #0b0e11; color: #eaecef; padding: 10px; margin: 0; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #2b3139; }
        .refresh-btn { background: #f0b90b; color: #000; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .refresh-btn:disabled { background: #474d57; color: #848e9c; }
        .grid { display: flex; gap: 10px; flex-direction: column; }
        @media (min-width: 992px) { .grid { flex-direction: row; } }
        .column { flex: 1; background: #181a20; padding: 12px; border-radius: 12px; border: 1px solid #2b3139; margin-top: 10px; }
        .col-title { color: #f0b90b; font-size: 16px; font-weight: bold; margin-bottom: 5px; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; color: #848e9c; font-size: 11px; border-bottom: 1px solid #2b3139; padding: 5px; }
        td { padding: 8px 5px; border-bottom: 1px solid #2b3139; font-size: 13px; }
        .symbol { color: #f0b90b; font-weight: bold; }
        .up { color: #02c076; }
        .down { color: #f84960; }
        #status { text-align: center; color: #f0b90b; font-size: 13px; padding: 10px; }
    </style>
</head>
<body>
    <div class="header">
        <h2 style="margin:0; font-size: 18px;">ğŸ“Š æ¥µé€Ÿç›£æ§ V5</h2>
        <button id="btn" class="refresh-btn" onclick="run()">âš¡ ç«‹å³æƒæ</button>
    </div>
    <div id="status">é»æ“ŠæŒ‰éˆ•é–‹å§‹ (æ’é™¤æ–°å¹£)</div>
    
    <div class="grid">
        <div class="column">
            <div class="col-title">âš¡ çŸ­ç·šçˆ†ç™¼ (30M)</div>
            <table>
                <thead><tr><th>å¹£ç¨®</th><th>é‡æ¯”</th><th>æ¼²å¹…</th></tr></thead>
                <tbody id="sBody"></tbody>
            </table>
        </div>
        <div class="column">
            <div class="col-title">ğŸ§ª æ½›åŠ›å¸ç±Œ (8H)</div>
            <table>
                <thead><tr><th>å¹£ç¨®</th><th>é‡æ¯”</th><th>æ¼²å¹…</th></tr></thead>
                <tbody id="lBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        // æ ¸å¿ƒåŠ é€Ÿé‚è¼¯ï¼šä¸€æ¬¡æ‹¿æ‰€æœ‰å¹£çš„ 24H æ•¸æ“šï¼Œæ¸›å°‘ 200 å¤šæ¬¡å–®ç¨è«‹æ±‚
        async function run() {
            const btn = document.getElementById('btn');
            const status = document.getElementById('status');
            btn.disabled = true;
            status.innerText = "ğŸš€ æ­£åœ¨æ¥µé€ŸæŠ“å–å…¨å¸‚å ´æ•¸æ“š...";

            try {
                // 1. åŒæ­¥ç²å–å…¨å¸‚å ´ 24H åƒ¹æ ¼èˆ‡æˆäº¤é‡
                const tickerResp = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr');
                const allTickers = await tickerResp.json();
                
                // 2. éæ¿¾æ‰é USDT åˆç´„
                const usdtPairs = allTickers.filter(t => t.symbol.endsWith('USDT'));
                
                // 3. ç²å–ç•¶å‰ 1 å°æ™‚ K ç·šæ•¸æ“š (ç”¨æ–¼è¨ˆç®—å¹³å‡é‡æ¯”)
                // ç‚ºäº†é€Ÿåº¦ï¼Œæˆ‘å€‘å…ˆç”¨ 24H ç¸½é‡èˆ‡ 1H é‡çš„ç°¡å–®å°æ¯”ä¾†åšç¬¬ä¸€å±¤ç¯©é¸
                let sRes = [], lRes = [];

                usdtPairs.forEach(t => {
                    const symbol = t.symbol;
                    const curPrice = parseFloat(t.lastPrice);
                    const high = parseFloat(t.highPrice);
                    const low = parseFloat(t.lowPrice);
                    const chg = parseFloat(t.priceChangePercent);
                    const quoteVol = parseFloat(t.quoteVolume); // 24å°æ™‚æˆäº¤é¡
                    
                    // ä¼°ç®—é‡æ¯”ï¼š24H æˆäº¤é¡ / 24 = å¹³å‡æ¯å°æ™‚æˆäº¤é¡
                    // æˆ‘å€‘æŠ“é‚£äº›ã€Œç¾åœ¨æˆäº¤é¡ã€æ˜é¡¯å¤§æ–¼ã€Œå¹³å‡å€¼ã€çš„å¹£
                    // é€™è£¡æš«ç”¨ç°¡åŒ–ç®—æ³•æå‡é€Ÿåº¦
                    const avgHourlyVol = quoteVol / 24;
                    // å‡è¨­ç¾åœ¨é€™å°æ™‚çš„é‡æ˜¯é€é 24hr æ•¸æ“šæ¨ç®—çš„ç°¡åŒ–æŒ‡æ¨™
                    const simpleRatio = (quoteVol / (avgHourlyVol * 24)) * (Math.abs(chg) > 2 ? 1.5 : 1);

                    // å·¦é‚Šï¼šçˆ†ç™¼å¹£ (æ¼²å¹…å¤§ä¸”æœ‰é‡)
                    if (simpleRatio > 1.5 && chg > 3) {
                        sRes.push({ s: symbol, r: simpleRatio, c: chg });
                    }
                    
                    // å³é‚Šï¼šå¸ç±Œå¹£ (åƒ¹æ ¼åœ¨åº•éƒ¨ 40% å€åŸŸä¸”æ¼²å¹…æº«å’Œ 0~4%)
                    const pricePos = (curPrice - low) / (high - low);
                    if (simpleRatio > 1.1 && pricePos < 0.4 && chg > 0 && chg < 4) {
                        lRes.push({ s: symbol, r: simpleRatio, c: chg });
                    }
                });

                const fmt = (c) => `<span class="${c>=0?'up':'down'}">${c>=0?'+':''}${c.toFixed(2)}%</span>`;
                const render = (arr) => arr.sort((a,b)=>b.r-a.r).slice(0, 15).map(r => `
                    <tr>
                        <td class="symbol">${r.s.replace('USDT','')}</td>
                        <td style="color:#02c076;font-weight:bold;">${r.r.toFixed(1)}x</td>
                        <td>${fmt(r.c)}</td>
                    </tr>`).join('');

                document.getElementById('sBody').innerHTML = render(sRes) || "<tr><td colspan='3'>å¸‚å ´æš«ç„¡æš´å‹•</td></tr>";
                document.getElementById('lBody').innerHTML = render(lRes) || "<tr><td colspan='3'>å°šç„¡åº•éƒ¨å¸ç±Œ</td></tr>";
                
                status.innerText = "âœ… ç§’ç´šæƒæå®Œæˆ (" + new Date().toLocaleTimeString() + ")";
            } catch (err) {
                status.innerText = "âŒ å¹£å®‰é€£ç·šè¶…æ™‚ï¼Œè«‹ç¨å¾Œå†è©¦";
                console.error(err);
            }
            btn.disabled = false;
        }
        // é€²å…¥é é¢è‡ªå‹•è·‘ä¸€æ¬¡
        run();
    </script>
</body>
</html>
