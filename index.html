<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>HUNTER V157 | æŠ€è¡“æ‹†è§£ç‰ˆ</title>
    <style>
        body { background: #000; color: #eee; font-family: 'Segoe UI', sans-serif; padding: 20px; font-size: 13px; }
        .header { background: #111; padding: 20px; border-radius: 8px; border: 1px solid #333; margin-bottom: 20px; }
        .monitor-bar { display: flex; gap: 30px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #222; }
        .index-item { display: flex; align-items: center; gap: 10px; }
        .index-name { color: #f2a900; font-weight: bold; font-size: 15px; }
        .index-price { font-family: 'Consolas', monospace; font-size: 18px; font-weight: bold; color: #fff; }
        .controls { display: flex; justify-content: space-between; align-items: center; }
        .search-group { display: flex; gap: 15px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #333; padding: 12px; text-align: center; }
        th { background: #1a1a1a; color: #f2a900; }
        .row-tangling { background: rgba(0, 255, 204, 0.08) !important; border-left: 4px solid #00ffcc; }
        .lv-high { color: #ff4444; font-weight: bold; text-shadow: 0 0 8px #ff4444; animation: blink 0.8s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
        .score-box { background: #333; color: #fff; padding: 5px; border-radius: 4px; font-weight: bold; border: 1px solid #444; display: inline-block; min-width: 40px; }
        .score-detail { font-size: 9px; color: #aaa; display: block; margin-top: 4px; letter-spacing: 1px; }
        .info-tag { font-size: 10px; color: #777; display: block; margin-top: 3px; }
        .btn { border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        input { background: #111; border: 1px solid #444; color: #fff; padding: 8px; border-radius: 4px; width: 180px; }
        .del-btn { color: #ff4444; cursor: pointer; font-size: 16px; }
    </style>
</head>
<body>
    <div class="header">
        <div class="monitor-bar">
            <div class="index-item">
                <span class="index-name">BTC</span>
                <span id="btc-price" class="index-price">è¼‰å…¥ä¸­...</span>
                <span id="btc-chg">--</span>
            </div>
            <div class="index-item">
                <span class="index-name">ETH</span>
                <span id="eth-price" class="index-price">è¼‰å…¥ä¸­...</span>
                <span id="eth-chg">--</span>
            </div>
        </div>
        <div class="controls">
            <div class="search-group">
                <input type="text" id="search-input" placeholder="ğŸ” æœå°‹å¹£ç¨®..." oninput="renderTable()">
                <button id="btn-sound" class="btn" onclick="toggleSound()" style="background:#222;color:#bbb;border:1px solid #444;">ğŸ”Š è²éŸ³: é–‹</button>
            </div>
            <button id="btn-toggle" class="btn" onclick="toggleMonitor()" style="background:#f2a900;color:#000;">å•Ÿå‹•ç›£æ§æƒæ</button>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th width="50">æ“ä½œ</th>
                <th width="80">é¡å‹</th>
                <th>å¹£ç¨®èˆ‡å€é–“</th>
                <th>ğŸš€ è¡åˆºç­‰ç´š (é€Ÿåº¦/ä¸»å‹•è²·)</th>
                <th>æŠ€è¡“ç¸½åˆ† (åˆ†é …æ‹†è§£)</th>
                <th>è³‡è²» (Â±0.05)</th>
                <th>24H æ¼²è·Œ</th>
            </tr>
        </thead>
        <tbody id="list-body"></tbody>
    </table>

<script>
    let isMonitoring = false, isSoundOn = true, timer = null;
    let rawResults = [], blackList = new Set();
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function toggleSound() { isSoundOn = !isSoundOn; document.getElementById('btn-sound').innerText = isSoundOn ? "ğŸ”Š è²éŸ³: é–‹" : "ğŸ”‡ è²éŸ³: é—œ"; }
    function playBeep() {
        if (!isSoundOn) return;
        const o = audioCtx.createOscillator(), g = audioCtx.createGain();
        o.frequency.setValueAtTime(1000, audioCtx.currentTime); g.gain.setValueAtTime(0.05, audioCtx.currentTime);
        o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + 0.1);
    }

    async function updateIndex() {
        try {
            const symbols = ['BTCUSDT', 'ETHUSDT'];
            for (const s of symbols) {
                const r = await fetch(`https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=${s}`).then(res => res.json());
                const id = s.replace('USDT','').toLowerCase();
                const chg = parseFloat(r.priceChangePercent);
                document.getElementById(`${id}-price`).innerText = parseFloat(r.lastPrice).toLocaleString();
                document.getElementById(`${id}-chg`).innerText = `${chg > 0 ? '+' : ''}${chg}%`;
                document.getElementById(`${id}-chg`).style.color = chg >= 0 ? '#00ffcc' : '#ff4444';
            }
        } catch(e) {}
    }
    setInterval(updateIndex, 3000); updateIndex();

    function toggleMonitor() {
        isMonitoring = !isMonitoring;
        const btn = document.getElementById('btn-toggle');
        btn.innerText = isMonitoring ? "ğŸ›‘ åœæ­¢ç›£æ§" : "å•Ÿå‹•ç›£æ§æƒæ";
        btn.style.background = isMonitoring ? "#ff4444" : "#f2a900";
        if(isMonitoring) { startScan(); timer = setInterval(startScan, 15000); } else { clearInterval(timer); }
    }

    function removeSymbol(s) { blackList.add(s); renderTable(); }

    async function getSymbolData(s) {
        try {
            const [tData, fRes, hK, mK] = await Promise.all([
                fetch(`https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=${s}`).then(r=>r.json()),
                fetch(`https://fapi.binance.com/fapi/v1/premiumIndex?symbol=${s}`).then(r=>r.json()),
                fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=1h&limit=25`).then(r=>r.json()),
                fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=1m&limit=60`).then(r=>r.json())
            ]);
            
            const now = parseFloat(hK[24][4]), hCloses = hK.map(k=>parseFloat(k[4]));
            const ma7 = hCloses.slice(-7).reduce((a,b)=>a+b,0)/7, ma25 = hCloses.slice(-25).reduce((a,b)=>a+b,0)/25;
            const ranges = hK.map(k => parseFloat(k[2]) - parseFloat(k[3])), avgR = (ranges.slice(0, 24).reduce((a,b)=>a+b,0) / 24) || 0.001;

            // æŠ€è¡“æ‹†è§£ï¼š[æ³¢å‹•|ç³¾çµ|é‡èƒ½|è¶¨å‹¢]
            const s1 = Math.round(Math.min(25, ((parseFloat(hK[24][2]) - parseFloat(hK[24][3]))/avgR/1.8)*25));
            const s2 = (Math.abs(ma7-ma25)/ma25*100 < 3) ? 25 : 0;
            const s3 = Math.round(Math.min(25, (parseFloat(tData.quoteVolume)/45000000)*12.5));
            const s4 = (now > ma7 && ma7 > ma25) ? 25 : 0;
            const totalScore = s1 + s2 + s3 + s4;

            const totalVol1m = parseFloat(mK[59][5]), takerVol1m = parseFloat(mK[59][9]), avgVol1m = mK.reduce((a,b)=>a+parseFloat(b[5]),0) / 60;
            const vRatio = totalVol1m / avgVol1m, buyRatio = (takerVol1m / totalVol1m) * 100;

            let thrustLv = 1;
            if (vRatio > 1.2) {
                let base = vRatio * 1.8;
                if (buyRatio > 65) base += 3; else if (buyRatio < 50) base -= 2;
                thrustLv = Math.max(2, Math.min(10, Math.round(base)));
            }

            const funding = parseFloat(fRes.lastFundingRate * 100);
            const isTangling = (funding >= -0.05 && funding <= 0.05);
            if (isMonitoring && thrustLv >= 8 && isTangling) playBeep();

            return { 
                s, totalScore, sDetail: `${s1}|${s2}|${s3}|${s4}`, thrustLv, vRatio: vRatio.toFixed(1), buyRatio: buyRatio.toFixed(0),
                tp: ((avgR/now)*100*2.8).toFixed(1), sl: ((avgR/now)*100*2.2).toFixed(1),
                funding, change: tData.priceChangePercent, isTangling 
            };
        } catch(e) { return null; }
    }

    async function startScan() {
        const tData = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr').then(r=>r.json());
        let baseSymbols = tData.filter(d => d.symbol.endsWith('USDT') && parseFloat(d.quoteVolume) > 30000000).sort((a,b)=>b.quoteVolume-a.quoteVolume).slice(0, 35);
        let results = [];
        for (let d of baseSymbols) {
            if(blackList.has(d.symbol)) continue;
            const res = await getSymbolData(d.symbol);
            if (res && res.totalScore > 30) results.push(res);
        }
        rawResults = results; renderTable();
    }

    function renderTable() {
        const keyword = document.getElementById('search-input').value.toUpperCase();
        let filtered = rawResults.filter(r => r.s.includes(keyword));
        filtered.sort((a, b) => (a.isTangling === b.isTangling) ? (b.totalScore - a.totalScore) : (a.isTangling ? -1 : 1));
        document.getElementById('list-body').innerHTML = filtered.map(r => `
            <tr class="${r.isTangling ? 'row-tangling' : ''}">
                <td><span class="del-btn" onclick="removeSymbol('${r.s}')">âœ•</span></td>
                <td>${r.isTangling ? 'ğŸ’ ç³¾çµ' : 'ğŸ“Š è¶¨å‹¢'}</td>
                <td style="font-weight:bold;">${r.s.replace('USDT','')}<span class="info-tag">ğŸ¯ ${r.tp}% / -${r.sl}%</span></td>
                <td class="${r.thrustLv >= 8 ? 'lv-high' : ''}">LV ${r.thrustLv}<span class="info-tag">${r.vRatio}x / ${r.buyRatio}%</span></td>
                <td><span class="score-box">${r.totalScore}</span><span class="score-detail">${r.sDetail}</span></td>
                <td style="color:${r.isTangling ? '#00ffcc' : '#eee'}">${r.funding.toFixed(4)}%</td>
                <td style="color:#00ffcc">${r.change}%</td>
            </tr>
        `).join('');
    }
</script>
</body>
</html>
