<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>HUNTER PRO | V158 é‚è¼¯ä¿®æ­£ç‰ˆ</title>
    <style>
        body { background: #000; color: #eee; font-family: 'Segoe UI', sans-serif; padding: 20px; font-size: 12px; }
        .header { display: flex; justify-content: space-between; align-items: center; background: #1c1c1c; padding: 15px; border-radius: 8px; border: 1px solid #333; margin-bottom: 20px; }
        .control-panel { background: #252525; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #444; }
        input { background: #333; border: 1px solid #555; color: #fff; padding: 8px; border-radius: 4px; outline: none; width: 180px; }
        #diag-box { background: #1a1a1a; border: 2px solid #f2a900; padding: 15px; border-radius: 5px; display: none; margin-top: 10px; line-height: 1.6; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #333; padding: 10px; text-align: center; }
        th { background: #252525; color: #f2a900; }
        .row-highlight { background: rgba(242, 169, 0, 0.1) !important; border-left: 4px solid #f2a900; }
        .tp-now { color: #00ffcc; font-weight: bold; border: 1px solid #00ffcc; padding: 1px 4px; border-radius: 3px; font-size: 10px; }
        .tp-5d { color: #f2a900; font-weight: bold; border: 1px solid #f2a900; padding: 1px 4px; border-radius: 3px; font-size: 10px; margin-left: 3px; }
        .score-box { background: #444; color: #fff; padding: 4px 10px; border-radius: 3px; font-weight: bold; font-size: 14px; display: inline-block; }
        .score-100 { background: linear-gradient(45deg, #f2a900, #ff5500); }
        .sub-score { font-size: 10px; color: #aaa; margin-top: 4px; display: block; }
        .btn { background: #f2a900; color: #000; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-del { background: #ff4444; color: #fff; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 11px; }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <span style="font-size: 20px; font-weight: bold; color: #f2a900;">ğŸ¯ HUNTER PRO æŠ€è¡“é›·é” (V158)</span>
            <span id="update-time" style="margin-left: 15px; color: #888;"></span>
        </div>
        <button class="btn" onclick="toggleMonitor()" id="btn-toggle">ğŸ“¡ å•Ÿå‹•æƒæ</button>
    </div>

    <div class="control-panel">
        <input type="text" id="search-input" placeholder="æ‰“å¹£å(å¦‚ SOL, PEPE)">
        <button class="btn" onclick="diagnoseSymbol()">ğŸ” å¼·åŠ›è¨ºæ–·</button>
        <button class="btn" style="background:#555; color:#fff" onclick="clearBlacklist()">é‡è¨­åå–®</button>
        <div id="diag-box"></div>
    </div>

    <table>
        <thead>
            <tr>
                <th>é¡å‹</th>
                <th>å¹£ç¨® / å»ºè­°åœåˆ© (ç¾ / 5D)</th>
                <th>æŠ€è¡“ç¸½åˆ† (æ³¢/ç³¾/é‡/çª)</th>
                <th>è³‡è²»ç›£æ§ (Â±0.05)</th>
                <th>æŒ‡æ¨™æ•¸æ“š (æ³¢/è·é«˜)</th>
                <th>24H æ¼²è·Œ</th>
                <th>ç®¡ç†</th>
            </tr>
        </thead>
        <tbody id="list-body"></tbody>
    </table>

<script>
    let isMonitoring = false;
    let timer = null;
    let userBlacklist = new Set();
    const EXCLUDE_LIST = ['BTCUSDT', 'ETHUSDT', 'USDCUSDT', 'FDUSDUSDT', 'BUSDUSDT', 'DAIUSDT'];

    function toggleMonitor() {
        isMonitoring = !isMonitoring;
        document.getElementById('btn-toggle').innerText = isMonitoring ? "ğŸ›‘ åœæ­¢ç›£æ§" : "ğŸ“¡ å•Ÿå‹•æƒæ";
        document.getElementById('btn-toggle').style.background = isMonitoring ? "#ff4444" : "#f2a900";
        if(isMonitoring) { startScan(); timer = setInterval(startScan, 15000); }
        else { clearInterval(timer); }
    }

    const getMA = (arr, p) => arr.length < p ? 0 : arr.slice(-p).reduce((a, b) => a + b, 0) / p;

    async function getSymbolData(s) {
        try {
            const [tData, fRes, hK] = await Promise.all([
                fetch(`https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=${s}`).then(r=>r.json()),
                fetch(`https://fapi.binance.com/fapi/v1/premiumIndex?symbol=${s}`).then(r=>r.json()),
                fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=1h&limit=121`).then(r=>r.json())
            ]);
            if(!tData.symbol) return null;
            
            const now = parseFloat(hK[hK.length-1][4]);
            const hCloses = hK.map(k=>parseFloat(k[4])), ma7 = getMA(hCloses, 7), ma25 = getMA(hCloses, 25);
            const funding = parseFloat(fRes.lastFundingRate * 100);

            const ranges = hK.map(k => parseFloat(k[2]) - parseFloat(k[3]));
            const avgR24 = (ranges.slice(-25, -1).reduce((a,b)=>a+b,0) / 24);
            const tpNow = ((avgR24 / now) * 100 * 2.8).toFixed(1);
            const avgR5D = (ranges.slice(0, 120).reduce((a,b)=>a+b,0) / 120);
            const tp5D = ((avgR5D / now) * 100 * 2.8).toFixed(1);

            const vRatio = (parseFloat(hK[hK.length-1][2]) - parseFloat(hK[hK.length-1][3])) / avgR24;
            const vScore = Math.min(25, (vRatio / 1.8) * 25); 
            const hDiff = Math.abs(ma7 - ma25) / ma25 * 100;
            const tangleScore = (hDiff < 3) ? (25 * (1 - hDiff/3)) : 0; 
            const qScore = Math.min(25, (parseFloat(tData.quoteVolume) / 40000000) * 12.5); 
            const recentH = Math.max(...hK.slice(-4).map(k=>parseFloat(k[2])));
            const distToH = Math.abs(now - recentH) / recentH * 100;
            const hScore = (distToH <= 2) ? 25 : 0; 

            return { 
                s, totalScore: Math.round(vScore + tangleScore + qScore + hScore), 
                vScore: vScore.toFixed(0), tangleScore: tangleScore.toFixed(0), 
                qScore: qScore.toFixed(0), hScore: hScore.toFixed(0), 
                funding, vRatio, distToH, tpNow, tp5D,
                change: tData.priceChangePercent, 
                isBull: (ma7 > ma25), // ä¿®æ­£ï¼šç§»é™¤æ”¶ç´…é™åˆ¶ï¼Œåƒ…ä¿ç•™è¶¨å‹¢éæ¿¾
                isFocus: (funding >= -0.05 && funding <= 0.05)
            };
        } catch(e) { return null; }
    }

    async function diagnoseSymbol() {
        let s = document.getElementById('search-input').value.trim().toUpperCase();
        if(!s) return; if(!s.endsWith('USDT')) s += 'USDT';
        const box = document.getElementById('diag-box');
        box.style.display = 'block'; box.innerHTML = "â³ æœå°‹ä¸­...";
        const d = await getSymbolData(s);
        if(!d) { box.innerHTML = `<span style="color:#ff4444">âŒ æ‰¾ä¸åˆ° [${s}]</span>`; return; }
        box.innerHTML = `
            <div style="font-weight:bold; color:#f2a900;">ğŸ“Š ${s} | <span class="tp-now">ç¾: ${d.tpNow}%</span> <span class="tp-5d">5D: ${d.tp5D}%</span></div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; font-size:11px; margin-top:5px; background: #222; padding: 10px; border-radius: 5px;">
                <div>ğŸŒªï¸ æ³¢å‹•ï¼š${d.vScore}</div><div>ğŸ§¶ ç³¾çµï¼š${d.tangleScore}</div>
                <div>ğŸ“ˆ é‡èƒ½ï¼š${d.qScore}</div><div>ğŸ¯ çªç ´ï¼š${d.hScore}</div>
            </div>
            <div style="font-weight:bold; text-align:right;">æŠ€è¡“ç¸½åˆ†ï¼š${d.totalScore}</div>
        `;
    }

    async function startScan() {
        try {
            const infoRes = await fetch('https://fapi.binance.com/fapi/v1/exchangeInfo');
            const infoData = await infoRes.json();
            const perpetualSymbols = infoData.symbols
                .filter(s => s.contractType === 'PERPETUAL' && s.status === 'TRADING' && s.quoteAsset === 'USDT')
                .map(s => s.symbol);

            const tRes = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr');
            const tData = await tRes.json();
            
            let baseSymbols = tData.filter(d => 
                perpetualSymbols.includes(d.symbol) && !EXCLUDE_LIST.includes(d.symbol) && 
                !userBlacklist.has(d.symbol) && parseFloat(d.quoteVolume) > 20000000 && parseFloat(d.priceChangePercent) > 0
            ).sort((a,b) => b.quoteVolume - a.quoteVolume).slice(0, 40);

            let results = [];
            for (let d of baseSymbols) {
                await new Promise(r => setTimeout(r, 25));
                const res = await getSymbolData(d.symbol);
                if (res && res.isBull && res.totalScore > 30) results.push(res);
            }

            results.sort((a, b) => (a.isFocus === b.isFocus) ? (b.totalScore - a.totalScore) : (a.isFocus ? -1 : 1));

            document.getElementById('list-body').innerHTML = results.map(r => `
                <tr class="${r.isFocus ? 'row-highlight' : ''}">
                    <td style="font-weight:bold; color:${r.isFocus ? '#f2a900' : '#eee'}">${r.isFocus ? 'ğŸ¯ çµäººé–å®š' : 'ğŸ“Š è¶¨å‹¢è¿½è¹¤'}</td>
                    <td style="font-weight:bold;">
                        ${r.s.replace('USDT','')} 
                        <span class="tp-now">${r.tpNow}%</span><span class="tp-5d">${r.tp5D}%</span>
                    </td>
                    <td>
                        <span class="score-box ${r.totalScore >= 80 ? 'score-100' : ''}">${r.totalScore}</span>
                        <span class="sub-score">${r.vScore}/${r.tangleScore}/${r.qScore}/${r.hScore}</span>
                    </td>
                    <td style="color:${r.isFocus ? '#00ffcc' : '#eee'}; font-weight:bold;">${r.funding.toFixed(4)}%</td>
                    <td style="color:#aaa;">æ³¢:${r.vRatio.toFixed(1)}x | è·é«˜:${r.distToH.toFixed(1)}%</td>
                    <td style="color:#00ffcc">${r.change}%</td>
                    <td><button class="btn-del" onclick="deleteSymbol('${r.s.replace('USDT','')}')">âŒ</button></td>
                </tr>
            `).join('');
            document.getElementById('update-time').innerText = "åˆ·æ–°: " + new Date().toLocaleTimeString();
        } catch (e) {}
    }

    function deleteSymbol(s) { userBlacklist.add(s + "USDT"); startScan(); }
    function clearBlacklist() { userBlacklist.clear(); startScan(); }
</script>
</body>
</html>
