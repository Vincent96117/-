<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é‡èƒ½ç›£æ§-ç§’é–‹éˆæ•ç‰ˆ</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #0b0e11; color: #eaecef; padding: 10px; margin: 0; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #2b3139; }
        .refresh-btn { background: #f0b90b; color: #000; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; }
        .refresh-btn:disabled { background: #474d57; opacity: 0.6; }
        .grid { display: flex; gap: 10px; flex-direction: column; }
        @media (min-width: 992px) { .grid { flex-direction: row; } }
        .column { flex: 1; background: #181a20; padding: 15px; border-radius: 12px; border: 1px solid #2b3139; margin-top: 10px; }
        .col-title { color: #f0b90b; font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; color: #848e9c; font-size: 12px; border-bottom: 1px solid #2b3139; padding: 8px 4px; }
        td { padding: 12px 4px; border-bottom: 1px solid #2b3139; font-size: 15px; }
        .symbol { color: #f0b90b; font-weight: bold; }
        .up { color: #02c076; font-weight: bold; }
        .down { color: #f84960; }
        #status { text-align: center; color: #848e9c; font-size: 13px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="header">
        <h2 style="margin:0; font-size: 18px;">ğŸ“Š å…¨å¸‚å ´ç›£æ§</h2>
        <button id="btn" class="refresh-btn" onclick="run()">ğŸ”„ åˆ·æ–°</button>
    </div>
    <div id="status">é»æ“Šåˆ·æ–°é–‹å§‹æƒæå…¨å¸‚å ´</div>
    
    <div class="grid">
        <div class="column">
            <div class="col-title">âš¡ çŸ­ç·šç•°å‹• (30M)</div>
            <div style="color:#848e9c; font-size:11px; margin-bottom:10px;">è¿‘ 30 åˆ†é˜çªç„¶çˆ†é‡ (åæ‡‰æœ€å¿«)</div>
            <table>
                <thead><tr><th width="45%">å¹£ç¨®</th><th width="30%">é‡æ¯”</th><th width="25%">æ¼²å¹…</th></tr></thead>
                <tbody id="sBody"></tbody>
            </table>
        </div>
        <div class="column">
            <div class="col-title">ğŸ“ˆ èµ·è·‘æ½›åŠ› (8H)</div>
            <div style="color:#848e9c; font-size:11px; margin-bottom:10px;">æˆäº¤é‡ç©©å®šæ”¾å¤§ï¼Œæ¼²å¹…æœªé 4%</div>
            <table>
                <thead><tr><th width="45%">å¹£ç¨®</th><th width="30%">é‡æ¯”</th><th width="25%">æ¼²å¹…</th></tr></thead>
                <tbody id="lBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        async function getData(s) {
            try {
                // å„ªåŒ–è«‹æ±‚ï¼Œæ¸›å°‘æ­·å²æ•¸æ“šé•·åº¦ï¼Œå¤§å¹…æå‡åˆ·æ–°é€Ÿåº¦
                const [h, m, t] = await Promise.all([
                    fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=1h&limit=24`).then(r => r.json()),
                    fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=5m&limit=48`).then(r => r.json()),
                    fetch(`https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=${s}`).then(r => r.json())
                ]);

                const baseVol = h.map(k => parseFloat(k[7])).reduce((a,b)=>a+b,0) / 24 / 12; // 24å°æ™‚å¹³å‡
                const currentVols = m.map(k => parseFloat(k[7]));
                const chg = parseFloat(t.priceChangePercent);
                
                const rS = (currentVols.slice(-6).reduce((a,b)=>a+b,0)/6)/baseVol; // 30M é‡æ¯”
                const rL = (currentVols.reduce((a,b)=>a+b,0)/48)/baseVol; // 4H é‡æ¯”

                return { s, rS, rL, chg };
            } catch(e) { return null; }
        }

        async function run() {
            const btn = document.getElementById('btn');
            const status = document.getElementById('status');
            btn.disabled = true;
            status.innerText = "ğŸš€ æ­£åœ¨å…¨é€Ÿæƒæä¸­...";
            
            const info = await fetch('https://fapi.binance.com/fapi/v1/exchangeInfo').then(r => r.json());
            const list = info.symbols.filter(s => s.quoteAsset === 'USDT' && s.contractType === 'PERPETUAL').map(s => s.symbol);
            
            let sRes = [], lRes = [];
            // ä¸¦è¡Œè«‹æ±‚åŠ å¿«é€Ÿåº¦
            const batchSize = 30; 
            for (let i = 0; i < list.length; i += batchSize) {
                const batch = await Promise.all(list.slice(i, i + batchSize).map(s => getData(s)));
                batch.forEach(r => {
                    if(r) {
                        // å·¦é‚Šï¼šé‡æ¯” > 1.8 å°±é€²æ¦œ
                        if(r.rS > 1.8) sRes.push(r);
                        // å³é‚Šï¼šé‡æ¯” > 1.2 ä¸” æ¼²å¹…åœ¨ 0~4% ä¹‹é–“ (å‰›é–‹å§‹ç™¼åŠ›)
                        if(r.rL > 1.2 && r.chg > 0 && r.chg < 4) lRes.push(r);
                    }
                });
            }

            const render = (items, key) => items.sort((a,b)=>b[key]-a[key]).slice(0, 15).map(r => `
                <tr>
                    <td class="symbol">${r.s.replace('USDT','')}</td>
                    <td style="color:#02c076; font-weight:bold;">${r[key].toFixed(1)}x</td>
                    <td class="${r.chg>=0?'up':'down'}">${r.chg>=0?'+':''}${r.chg.toFixed(1)}%</td>
                </tr>`).join('');

            document.getElementById('sBody').innerHTML = render(sRes, 'rS') || '<tr><td colspan="3">ç­‰å¾…çˆ†ç™¼</td></tr>';
            document.getElementById('lBody').innerHTML = render(lRes, 'rL') || '<tr><td colspan="3">ç­‰å¾…èµ·æ­¥</td></tr>';
            status.innerText = "âœ… å®Œæˆæ™‚é–“: " + new Date().toLocaleTimeString();
            btn.disabled = false;
        }
        run();
    </script>
</body>
</html>
