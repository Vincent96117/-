<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>HUNTER PRO | V134 ç³¾çµçªç ´ç›£æ§</title>
    <style>
        body { background: #000; color: #eee; font-family: 'Segoe UI', sans-serif; padding: 20px; font-size: 13px; }
        .header { display: flex; justify-content: space-between; align-items: center; background: #1c1c1c; padding: 15px; border-radius: 8px; border: 1px solid #333; margin-bottom: 20px; }
        .status-tag { padding: 5px 12px; border-radius: 4px; font-weight: bold; background: #333; }
        .on { background: #00ffcc; color: #000; }
        
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #333; padding: 12px; text-align: center; }
        th { background: #252525; color: #f2a900; position: sticky; top: 0; }

        /* ç³¾çµå¹£ç‰¹åˆ¥æ¨£å¼ */
        .row-tangling { background: rgba(255, 68, 68, 0.2) !important; border: 2px solid #ff4444 !important; }
        .tangling-tag { background: #ff4444; color: #fff; padding: 2px 6px; border-radius: 3px; font-size: 11px; font-weight: bold; }

        .score-box { background: #444; color: #fff; padding: 4px 10px; border-radius: 3px; font-weight: bold; font-size: 15px; }
        .score-high { background: linear-gradient(45deg, #f2a900, #ffcc00); color: #000; box-shadow: 0 0 10px #f2a900; }
        
        .btn { background: #f2a900; color: #000; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn:hover { transform: scale(1.05); }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <span style="font-size: 20px; font-weight: bold; color: #f2a900;">ğŸ¯ V134 ç³¾çµçªç ´ç›£æ§</span>
            <span id="update-time" style="margin-left: 15px; color: #888;"></span>
        </div>
        <button class="btn" onclick="toggleMonitor()" id="btn-toggle">ğŸ“¡ å•Ÿå‹•è‡ªå‹•ç›£æ§</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>é¡å‹</th>
                <th>å¹£ç¨®</th>
                <th>è©•åˆ† (ä¾æ­¤æ’åº)</th>
                <th>è³‡è²» (Â±0.05 æ¨™è¨˜)</th>
                <th>ç•¶å‰åƒ¹æ ¼</th>
                <th>24H æ¼²è·Œ</th>
            </tr>
        </thead>
        <tbody id="list-body">
            <tr><td colspan="6" style="padding: 50px; color: #666;">é»æ“ŠæŒ‰éˆ•é–‹å§‹æƒæå…¨å¸‚å ´æ•¸æ“š...</td></tr>
        </tbody>
    </table>

<script>
    let isMonitoring = false;
    let timer = null;

    function toggleMonitor() {
        isMonitoring = !isMonitoring;
        const btn = document.getElementById('btn-toggle');
        if(isMonitoring) {
            btn.innerText = "ğŸ›‘ åœæ­¢ç›£æ§";
            btn.style.background = "#ff4444";
            btn.style.color = "#fff";
            startScan();
            timer = setInterval(startScan, 5000); // æ¯ 5 ç§’åˆ·æ–°ä¸€æ¬¡
        } else {
            btn.innerText = "ğŸ“¡ å•Ÿå‹•è‡ªå‹•ç›£æ§";
            btn.style.background = "#f2a900";
            btn.style.color = "#000";
            clearInterval(timer);
        }
    }

    async function startScan() {
        const body = document.getElementById('list-body');
        document.getElementById('update-time').innerText = "æœ€å¾Œæ›´æ–°: " + new Date().toLocaleTimeString();
        
        try {
            // 1. æŠ“å– Ticker å’Œ Funding Rate
            const [tRes, fRes] = await Promise.all([
                fetch('https://fapi.binance.com/fapi/v1/ticker/24hr'),
                fetch('https://fapi.binance.com/fapi/v1/premiumIndex')
            ]);
            const tData = await tRes.json();
            const fData = await fRes.json();

            // æ•´ç†è³‡è²»å°ç…§è¡¨
            const fundingMap = {};
            fData.forEach(f => { fundingMap[f.symbol] = parseFloat(f.lastFundingRate * 100).toFixed(4); });

            let results = [];

            // 2. è¨ˆç®—è©•åˆ†
            tData.filter(d => d.symbol.endsWith('USDT')).forEach(d => {
                const s = d.symbol;
                const high = parseFloat(d.highPrice), low = parseFloat(d.lowPrice), vol = parseFloat(d.quoteVolume);
                const funding = parseFloat(fundingMap[s] || 0);
                
                let range = ((high - low) / low) * 100;
                let score = (vol > 8000000) ? Math.min(100, Math.round(range * 8 + 35)) : 0;

                // åˆ¤æ–·æ˜¯å¦ç‚ºã€Œç³¾çµå¹£ã€: è³‡è²»åœ¨ -0.05 åˆ° +0.05 ä¹‹é–“
                const isTangling = (funding >= -0.05 && funding <= 0.05);

                if (score >= 45) {
                    results.push({
                        symbol: s.replace('USDT',''),
                        score: score,
                        funding: funding,
                        isTangling: isTangling,
                        price: parseFloat(d.lastPrice),
                        change: d.priceChangePercent
                    });
                }
            });

            // 3. æ’åºé‚è¼¯ï¼šç³¾çµå¹£ç½®é ‚ > åˆ†æ•¸é«˜åˆ°ä½
            results.sort((a, b) => {
                if (a.isTangling && !b.isTangling) return -1;
                if (!a.isTangling && b.isTangling) return 1;
                return b.score - a.score;
            });

            // 4. æ¸²æŸ“è¡¨æ ¼
            body.innerHTML = results.map(r => `
                <tr class="${r.isTangling ? 'row-tangling' : ''}">
                    <td>${r.isTangling ? '<span class="tangling-tag">ç³¾çµçªç ´</span>' : 'æ™®é€šå¼·å‹¢'}</td>
                    <td style="font-weight:bold; font-size:16px;">${r.symbol}</td>
                    <td><span class="score-box ${r.score >= 80 ? 'score-high' : ''}">${r.score}</span></td>
                    <td style="color: ${r.isTangling ? '#ff4444' : '#eee'}; font-weight: bold;">${r.funding}%</td>
                    <td>${r.price}</td>
                    <td style="color: ${parseFloat(r.change) >= 0 ? '#00ffcc' : '#ff6666'}">${r.change}%</td>
                </tr>
            `).join('');

        } catch (e) { console.error("æ•¸æ“šæŠ“å–å¤±æ•—", e); }
    }
</script>
</body>
</html>
