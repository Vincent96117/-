<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡èƒ½ç›£æ§ V28 - çªç™¼å¼·äº®ç‰ˆ</title>
    <style>
        body { font-family: sans-serif; background: #0b0e11; color: #eaecef; padding: 10px; margin: 0; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #2b3139; }
        .refresh-btn { background: #f0b90b; color: #000; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 10px; margin-top: 10px; }
        .column { background: #181a20; padding: 15px; border-radius: 12px; border: 1px solid #2b3139; }
        .col-title { color: #f0b90b; font-size: 16px; font-weight: bold; margin-bottom: 5px; }
        .col-desc { color: #848e9c; font-size: 11px; margin-bottom: 15px; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; color: #848e9c; font-size: 11px; border-bottom: 1px solid #2b3139; padding: 8px 5px; }
        td { padding: 10px 5px; border-bottom: 1px solid #2b3139; font-size: 14px; }
        .symbol { color: #f0b90b; font-weight: bold; }
        .up { color: #02c076; font-weight: bold; }
        .down { color: #f84960; }
        #status { text-align: center; color: #f0b90b; font-size: 12px; margin: 10px 0; }
        
        /* ğŸ’¡ æ–°å¹£è·³å…¥å·¦é‚Šæ¬„ä½çš„è¶…æ˜é¡¯æ¨£å¼ */
        .new-arrival {
            animation: pulse-purple 3s infinite; 
            font-weight: bold;
        }
        @keyframes pulse-purple {
            0% { background-color: rgba(191, 0, 255, 0.1); }
            50% { background-color: rgba(191, 0, 255, 0.6); color: white; }
            100% { background-color: rgba(191, 0, 255, 0.1); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h2 style="margin:0; font-size: 18px;">ğŸ“Š å°ˆæ¥­ç›£æ§ V28 (æ–°å¹£å¼·äº®è­¦å ±)</h2>
        <div>
            <span id="timer" style="margin-right:10px; font-size:12px; color:#848e9c;">10s åˆ·æ–°</span>
            <button id="btn" class="refresh-btn" onclick="run()">âš¡ æ ¸å¿ƒæƒæ</button>
        </div>
    </div>
    <div id="status">ç•¶æ–°å¹£é€²å…¥å·¦ä¸€ã€Œç¬æ™‚çªç™¼ã€æ™‚æœƒéŸ¿éˆ´ä¸¦ä»¥ç´«è‰²é–ƒçˆ</div>
    
    <div class="grid">
        <div class="column">
            <div class="col-title">âš¡ 0.5H ç¬æ™‚çªç™¼ (è­¦å ±å€)</div>
            <div class="col-desc">å‰›èµ·è·³ã€é‡èƒ½ç‚¸è£‚ä¹‹é»‘é¦¬</div>
            <table><thead><tr><th>å¹£ç¨®</th><th>çˆ†ç™¼åŠ›</th><th>æ¼²å¹…</th></tr></thead><tbody id="instantBody"></tbody></table>
        </div>
        <div class="column">
            <div class="col-title">ğŸ”¥ 4H å¼·å‹¢è¿½è¹¤</div>
            <div class="col-desc">è¶¨å‹¢ç©©å®šã€é«˜ä½æ”¯æ’</div>
            <table><thead><tr><th>å¹£ç¨®</th><th>çˆ†ç™¼åŠ›</th><th>æ¼²å¹…</th></tr></thead><tbody id="trendBody"></tbody></table>
        </div>
        <div class="column">
            <div class="col-title">ğŸ“ˆ æœ‰é‡ç›¤æ•´åŸ‹ä¼</div>
            <div class="col-desc">æ´—ç›¤ä¸­ã€ç­‰å¾…è®Šç›¤çªç ´</div>
            <table><thead><tr><th>å¹£ç¨®</th><th>çˆ†ç™¼åŠ›</th><th>æ¼²å¹…</th></tr></thead><tbody id="sidewaysBody"></tbody></table>
        </div>
    </div>

    <audio id="alertSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

    <script>
        let previousInstantSymbols = new Set(); // è¨˜éŒ„ä¸Šä¸€è¼ªå·¦ä¸€çš„åå–®
        let timeLeft = 10;

        async function run() {
            const btn = document.getElementById('btn');
            const status = document.getElementById('status');
            btn.disabled = true;
            timeLeft = 10;

            try {
                const tResp = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr');
                const tickers = await tResp.json();
                
                let instantRes = [], trendRes = [], sidewaysRes = [];
                let currentInstantSymbols = new Set();

                const filtered = tickers.filter(t => t.symbol.endsWith('USDT') && !t.symbol.includes('_'));

                filtered.forEach(t => {
                    const symbol = t.symbol.replace('USDT', '');
                    const chg = parseFloat(t.priceChangePercent) || 0;
                    const high = parseFloat(t.highPrice);
                    const low = parseFloat(t.lowPrice);
                    const cur = parseFloat(t.lastPrice);
                    const vol24h = parseFloat(t.quoteVolume); 

                    const burstBase = (vol24h / 8) / (vol24h / 24); 
                    const realBurst = burstBase * (1 + Math.abs(chg)/15);
                    const pos = (cur - low) / (high - low);
                    const swing = (high - low) / low;

                    // 1. å„ªå…ˆåˆ†é…ï¼šç¬æ™‚çªç™¼ (0.5H å…§å‹•èƒ½æœ€å¼·)
                    if (realBurst > 2.2 && chg > 1.5 && chg < 6.0 && vol24h > 5000000) {
                        instantRes.push({ s: symbol, b: realBurst, c: chg });
                        currentInstantSymbols.add(symbol);
                    } 
                    // 2. æ¬¡è¦åˆ†é…ï¼šå¼·å‹¢è¶¨å‹¢ (å·²æˆå½¢ä¹‹å¼·å‹¢)
                    else if (realBurst > 1.8 && chg >= 6.0 && pos > 0.60 && vol24h > 8000000) {
                        trendRes.push({ s: symbol, b: realBurst, c: chg });
                    }
                    // 3. æœ«ä½åˆ†é…ï¼šæœ‰é‡ç›¤æ•´
                    else if (realBurst > 1.25 && swing < 0.18 && Math.abs(chg) < 3.0 && vol24h > 3000000) {
                        sidewaysRes.push({ s: symbol, b: realBurst, c: chg });
                    }
                });

                // ğŸ’¡ åˆ¤æ–·æ˜¯å¦æœ‰ã€Œæ–°é¢å­”ã€é€²å…¥å·¦ä¸€æ¬„ä½
                let newlyArrived = [];
                currentInstantSymbols.forEach(s => {
                    if (!previousInstantSymbols.has(s)) {
                        newlyArrived.push(s);
                    }
                });

                // å¦‚æœæœ‰æ–°å¹£é€²å…¥ï¼ŒéŸ¿éˆ´è­¦å ±
                if (newlyArrived.length > 0) {
                    document.getElementById('alertSound').play().catch(()=>{});
                }

                const fmt = (c) => `<span class="${c>=0?'up':'down'}">${c>=0?'+':''}${c.toFixed(2)}%</span>`;
                
                // æ¸²æŸ“å·¦ä¸€ï¼šåŠ ä¸Šã€Œæ–°é€²ã€ç´«è‰²æ¨™ç¤º
                document.getElementById('instantBody').innerHTML = instantRes.sort((a,b) => b.b - a.b).slice(0, 12).map(r => `
                    <tr class="${newlyArrived.includes(r.s) ? 'new-arrival' : ''}">
                        <td class="symbol">${r.s}</td>
                        <td style="color:#02c076;font-weight:bold;">${r.b.toFixed(1)}x</td>
                        <td>${fmt(r.c)}</td>
                    </tr>`).join('');

                // æ¸²æŸ“å…¶ä»–å…©æ¬„
                document.getElementById('trendBody').innerHTML = trendRes.sort((a,b) => b.b - a.b).slice(0, 12).map(r => `
                    <tr><td class="symbol">${r.s}</td><td style="color:#02c076;font-weight:bold;">${r.b.toFixed(1)}x</td><td>${fmt(r.c)}</td></tr>`).join('');

                document.getElementById('sidewaysBody').innerHTML = sidewaysRes.sort((a,b) => b.b - a.b).slice(0, 12).map(r => `
                    <tr><td class="symbol">${r.s}</td><td style="color:#02c076;font-weight:bold;">${r.b.toFixed(1)}x</td><td>${fmt(r.c)}</td></tr>`).join('');
                
                // æ›´æ–°ä¸Šä¸€è¼ªåå–®å­˜æª”
                previousInstantSymbols = currentInstantSymbols;
                status.innerText = "âœ… è‡ªå‹•æƒæä¸­... " + new Date().toLocaleTimeString();
            } catch (err) {
                status.innerText = "âŒ ç¶²è·¯é€£ç·šç•°å¸¸";
            }
            btn.disabled = false;
        }

        setInterval(() => {
            timeLeft--;
            document.getElementById('timer').innerText = timeLeft + "s åˆ·æ–°";
            if (timeLeft <= 0) run();
        }, 1000);

        run();
    </script>
</body>
</html>
