<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>V82.1 çµäººçµ‚æ¥µç‰ˆ</title>
    <style>
        :root { --bg: #000; --card: #111; --border: #333; --text: #eee; --surge: #3fb950; --fall: #f85149; --strong: #58a6ff; --alert: #ff6600; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; padding: 2px; margin: 0; font-size: 11px; overflow: hidden; width: 100vw; }
        .container { display: grid; grid-template-columns: 0.9fr 1fr 1.4fr 1.3fr 1.3fr; gap: 4px; height: calc(100vh - 60px); padding: 4px; box-sizing: border-box; }
        .card { background: #0d1117; border: 1px solid var(--border); border-radius: 4px; display: flex; flex-direction: column; overflow: hidden; }
        h2 { font-size: 0.8rem; padding: 6px; margin: 0; background: #161b22; border-bottom: 1px solid var(--border); text-align: center; }
        .scroll { flex: 1; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        td, th { padding: 6px 2px; border-bottom: 1px solid #21262d; text-align: center; }
        .news-li { padding: 8px; border-bottom: 1px solid #222; line-height: 1.4; font-size: 10px; }
        .news-time { color: #888; font-size: 9px; margin-right: 5px; }
        .trump-tag { background: #ff4444; color: #fff; padding: 1px 3px; border-radius: 2px; font-size: 9px; font-weight: bold; }
        .funding-high { background: #a6611a !important; color: white !important; font-weight: bold; }
        .header { display: flex; justify-content: space-between; padding: 5px 15px; background: #000; border-bottom: 1px solid #333; font-size: 12px; }
    </style>
</head>
<body>

<div class="header">
    <div id="price-line"><span style="color:#f2a900">BTC: --</span> | <span style="color:#627eea">ETH: --</span></div>
    <div style="color:var(--strong)">V82.1 å…¨åŠŸèƒ½ç©©å®šç‰ˆ (æ—¥æ›†+12Hæ–°è)</div>
    <button onclick="location.reload()" style="font-size:10px; cursor:pointer">ğŸ”„ åˆ·æ–°</button>
</div>

<div class="container">
    <div class="card"><h2 style="color:var(--surge)">ğŸš€ ç¬é–“å™´ç™¼</h2><div class="scroll"><table><tbody id="surge-list"></tbody></table></div></div>
    
    <div class="card"><h2 style="color:var(--strong)">ğŸ”¥ é«˜æª”å¼·å‹¢</h2><div class="scroll"><table><tbody id="strong-list"></tbody></table></div></div>

    <div class="card">
        <h2 style="color:var(--alert)">ğŸ›ï¸ 12Hå·æ™®å¿«è¨Š</h2>
        <div style="height: 65%;" class="scroll" id="trump-news-box">åµæ¸¬é€£ç·šä¸­...</div>
        <h2 style="color:var(--fall); border-top: 1px solid #333;">âš ï¸ è³‡é‡‘è²»ç‡</h2>
        <div style="height: 35%;" class="scroll"><table><tbody id="fund-list"></tbody></table></div>
    </div>

    <div class="card"><h2 style="color:#bc8cff">ğŸ’ æ½›åŠ›ç›£æ§</h2><div class="scroll"><table><tbody id="potential-list"></tbody></table></div></div>

    <div class="card">
        <h2 style="color:#58a6ff">ğŸ“… è²¡ç¶“æ—¥æ›†</h2>
        <div class="scroll">
            <iframe src="https://www.tradingview-widget.com/embed-widget/events/?locale=zh_TW&currencyFilter=USD" style="width:100%; height:100%; border:none;"></iframe>
        </div>
    </div>
</div>

<script>
    const MY_BARK_KEY = 'KQP2fTbTfPp4HnhQSYNaxH';
    const PANIC_KEY = '1d2a12a87781f05beea8bf24f011d4c99319fa9d';
    let lastNewsId = null, fundingMap = {}, dataMap = {}, lockedPotList = [];

    // ä½¿ç”¨ä»£ç†ä¼ºæœå™¨è§£æ±ºã€Œè¼‰å…¥ä¸­ã€çš„ CORS å•é¡Œ
    async function fetchTrumpNews() {
        const box = document.getElementById('trump-news-box');
        // åŠ ä¸Š cors-anywhere æˆ–ä½¿ç”¨å…¬å…±ä»£ç†ç¶²å€
        const url = `https://api.allorigins.win/get?url=${encodeURIComponent(`https://cryptopanic.com/api/v1/posts/?auth_token=${PANIC_KEY}&q=Trump&public=true`)}`;
        
        try {
            const res = await fetch(url);
            const rawData = await res.json();
            const data = JSON.parse(rawData.contents);
            
            if(!data.results || data.results.length === 0) {
                box.innerHTML = '<div style="padding:10px; color:#666">æš«ç„¡ 12H ç›¸é—œæ¶ˆæ¯</div>';
                return;
            }

            box.innerHTML = '';
            data.results.slice(0, 15).forEach((n, i) => {
                const time = new Date(n.published_at);
                const timeStr = `${time.getHours().toString().padStart(2,'0')}:${time.getMinutes().toString().padStart(2,'0')}`;
                const isT = n.title.toUpperCase().includes('TRUMP');
                box.insertAdjacentHTML('beforeend', `<div class="news-li"><span class="news-time">${timeStr}</span>${isT?'<span class="trump-tag">T</span> ':''}${n.title}</div>`);
                
                if (i === 0 && isT && n.id !== lastNewsId) {
                    fetch(`https://api.day.app/${MY_BARK_KEY}/ğŸ›ï¸å·æ™®å¿«è¨Š/${encodeURIComponent(n.title)}?group=TrumpV82`);
                    lastNewsId = n.id;
                }
            });
        } catch(e) {
            box.innerHTML = '<div style="padding:10px; color:red">é€£ç·šè¶…æ™‚ï¼Œè‡ªå‹•é‡è©¦ä¸­...</div>';
        }
    }

    // å¹£å®‰ WebSocket é€£ç·šèˆ‡é«˜æª”å¼·å‹¢é‚è¼¯
    function connectWS() {
        const ws = new WebSocket('wss://stream.binance.com:9443/ws/!ticker@arr');
        ws.onmessage = (e) => {
            JSON.parse(e.data).forEach(d => {
                if(d.s.endsWith('USDT')) {
                    const s = d.s.replace('USDT',''), p = parseFloat(d.c), p24 = parseFloat(d.P);
                    if(s==='BTC') document.getElementById('price-line').children[0].innerText = `BTC: ${p} (${p24}%)`;
                    if(s==='ETH') document.getElementById('price-line').children[1].innerText = `ETH: ${p} (${p24}%)`;
                    
                    // é«˜æª”å¼·å‹¢è£œå›
                    const sList = document.getElementById('strong-list');
                    let r = [...sList.querySelectorAll('tr')].find(x => x.innerHTML.includes(s));
                    if (p24 > 8.0) {
                        if (!r) sList.insertAdjacentHTML('beforeend', `<tr><td>${s}</td><td style="color:var(--surge)">${p24}%</td></tr>`);
                        else r.cells[1].innerText = `${p24}%`;
                    } else if (r) r.remove();

                    if(!dataMap[s]) dataMap[s]={lp:p};
                    const inst = ((p-dataMap[s].lp)/dataMap[s].lp)*100;
                    if(inst>=1.2) {
                        const b = document.getElementById('surge-list');
                        b.insertAdjacentHTML('afterbegin', `<tr><td>${s}</td><td style="color:var(--surge)">+${inst.toFixed(2)}%</td></tr>`);
                        if(b.children.length>12) b.lastElementChild.remove();
                    }
                    dataMap[s].lp=p;
                }
            });
        };
    }

    async function updateFunding() {
        try {
            const res = await fetch('https://fapi.binance.com/fapi/v1/premiumIndex');
            const data = await res.json();
            const list = document.getElementById('fund-list');
            list.innerHTML = '';
            data.filter(f => Math.abs(parseFloat(f.lastFundingRate)*100) >= 0.05)
                .sort((a,b) => Math.abs(b.lastFundingRate)-Math.abs(a.lastFundingRate))
                .slice(0,5).forEach(f => {
                    const r = (parseFloat(f.lastFundingRate)*100).toFixed(4);
                    list.insertAdjacentHTML('beforeend', `<tr><td>${f.symbol.replace('USDT','')}</td><td class="funding-high">${r}%</td></tr>`);
                });
        } catch(e) {}
    }

    // å•Ÿå‹•
    connectWS();
    updateFunding(); setInterval(updateFunding, 15000);
    fetchTrumpNews(); setInterval(fetchTrumpNews, 120000);
</script>
</body>
</html>
