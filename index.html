<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>HUNTER V174 | å‹•æ…‹æ¬Šé‡æ ¡å°ç‰ˆ</title>
    <style>
        body { background: radial-gradient(circle at top, #1a1c2c, #0d0e15); color: #e0e0e0; font-family: 'Segoe UI', sans-serif; padding: 20px; font-size: 13px; min-height: 100vh; margin: 0; }
        .header { background: rgba(30, 34, 54, 0.9); padding: 18px; border-radius: 12px; border: 1px solid #3d4465; margin: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.6); }
        .monitor-bar { display: flex; gap: 35px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #3d4465; }
        .index-item { display: flex; align-items: center; gap: 12px; }
        .index-name { color: #f2a900; font-weight: bold; font-size: 14px; }
        .index-price { font-family: 'Consolas', monospace; font-size: 19px; font-weight: bold; color: #ffffff; }
        .controls { display: flex; justify-content: space-between; align-items: center; }
        .search-group { display: flex; gap: 12px; align-items: center; }
        table { width: calc(100% - 40px); border-collapse: separate; border-spacing: 0 6px; margin: 0 20px 20px 20px; }
        th { background: #161925; color: #f2a900; padding: 16px; border-bottom: 2px solid #3d4465; text-transform: uppercase; }
        td { background: #1e2236; padding: 14px; text-align: center; border-top: 1px solid #2d3250; border-bottom: 1px solid #2d3250; transition: 0.3s; }
        .row-strong td { background: #1a2f2a !important; border-top-color: #00ffcc; border-bottom-color: #00ffcc; }
        .row-weak td { opacity: 0.6; background: #2a1a1a !important; }
        .score-box { padding: 8px 16px; border-radius: 6px; font-weight: 900; font-size: 20px; border: 1px solid #444; display: inline-block; }
        .score-alert { color: #ff3e3e; background: #3a1a1a; border-color: #ff3e3e; box-shadow: 0 0 15px #ff3e3e; animation: alert-blink 0.6s infinite; }
        @keyframes alert-blink { 50% { opacity: 0.6; transform: scale(1.05); } }
        .lv-high { color: #ff5252; font-weight: bold; text-shadow: 0 0 10px #ff5252; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.6; } }
        .light { width: 16px; height: 6px; border-radius: 2px; display: inline-block; margin: 0 2px; }
        .light-green { background: #00ffcc; box-shadow: 0 0 8px #00ffcc; }
        .light-yellow { background: #f2a900; }
        .light-red { background: #ff5252; }
    </style>
</head>
<body>
    <div class="header">
        <div class="monitor-bar">
            <div class="index-item"><span class="index-name">BTC</span><span id="btc-price" class="index-price">--</span></div>
            <div class="index-item"><span class="index-name">ETH</span><span id="eth-price" class="index-price">--</span></div>
        </div>
        <div class="controls">
            <div class="search-group">
                <input type="text" id="search-input" placeholder="ğŸ” æœå°‹é»‘é¦¬..." onkeydown="if(event.key==='Enter') searchFromBinance()">
                <button class="btn" onclick="toggleMonitor()" id="btn-toggle" style="background:#f2a900;color:#000;padding:10px 20px;border-radius:8px;font-weight:bold;">å•Ÿå‹•æƒæ</button>
            </div>
        </div>
    </div>
    <table id="main-table">
        <thead><tr><th>âœ•</th><th>é¡å‹</th><th>å¹£ç¨® / ATR</th><th>LV è¡åˆº</th><th>æŠ€è¡“ç¸½åˆ†(å«è„«é‰¤æ¬Šé‡)</th><th>è³‡è²»</th><th>24H</th></tr></thead>
        <tbody id="list-body"></tbody>
    </table>

<script>
    let isMonitoring = false, rawResults = [], blackList = new Set(), lvMemory = {}, btcLastHourChg = 0;
    const top25Exclude = ["BTCUSDT", "ETHUSDT", "USDTUSDT", "BNBUSDT", "SOLUSDT", "XRPUSDT", "ADAUSDT", "DOGEUSDT", "AVAXUSDT", "TRXUSDT", "DOTUSDT", "LINKUSDT", "SHIBUSDT", "LTCUSDT", "BCHUSDT", "NEARUSDT", "UNIUSDT", "BNXUSDT"];

    async function updateBTC() {
        const k = await fetch('https://fapi.binance.com/fapi/v1/klines?symbol=BTCUSDT&interval=1h&limit=2').then(r=>r.json());
        const p = await fetch('https://fapi.binance.com/fapi/v1/ticker/price?symbol=BTCUSDT').then(r=>r.json());
        document.getElementById('btc-price').innerText = parseFloat(p.price).toLocaleString();
        btcLastHourChg = (parseFloat(k[1][4]) - parseFloat(k[0][4])) / parseFloat(k[0][4]);
    }
    setInterval(updateBTC, 5000); updateBTC();

    async function getSymbolData(s) {
        try {
            const [tData, fRes, hK, mK] = await Promise.all([
                fetch(`https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=${s}`).then(r=>r.json()),
                fetch(`https://fapi.binance.com/fapi/v1/premiumIndex?symbol=${s}`).then(r=>r.json()),
                fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=1h&limit=25`).then(r=>r.json()),
                fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=1m&limit=5`).then(r=>r.json())
            ]);
            const now = parseFloat(hK[24][4]), min4h = Math.min(...hK.slice(20, 24).map(k=>parseFloat(k[3])));
            const altHourChg = (now - parseFloat(hK[23][0])) / parseFloat(hK[23][0]);
            
            // å‹•æ…‹è„«é‰¤æ¬Šé‡æ ¸å¿ƒ
            let weight = 0, type = "ğŸ“Š è¶¨å‹¢";
            if (altHourChg > 0.02 && btcLastHourChg <= 0) { weight = 20; type = "ğŸš€ å¼·åŠ›è„«é‰¤"; }
            else if (altHourChg > 0.01 && altHourChg > btcLastHourChg) { weight = 10; type = "ğŸ’ ç¨ç«‹"; }
            else if (altHourChg < -0.01 && btcLastHourChg >= 0) { weight = -15; type = "âš ï¸ å¼±å‹¢"; }

            const s1 = 25, s2 = 25, s3 = 25, s4 = 25; // ç°¡åŒ–å±•ç¤ºåŸºæœ¬åˆ†
            let totalScore = 70 + weight; 
            if (now < min4h) totalScore = 0;

            const vRatio = parseFloat(mK[4][5]) / 1; // ç°¡åŒ–é‚è¼¯
            if (!lvMemory[s]) lvMemory[s] = 1;
            lvMemory[s] = (vRatio > 1.5) ? 10 : Math.max(1, lvMemory[s]-1);

            return { s, totalScore, type, thrustLv: lvMemory[s], funding: fRes.lastFundingRate*100, change: tData.priceChangePercent, weight };
        } catch(e){return null;}
    }

    async function startScan() {
        if(!isMonitoring) return;
        const t = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr').then(r=>r.json());
        let symbols = t.filter(d=>d.symbol.endsWith('USDT') && parseFloat(d.quoteVolume)>10000000).slice(0,50);
        let res = [];
        for(let d of symbols) {
            if(blackList.has(d.symbol) || top25Exclude.includes(d.symbol)) continue;
            const data = await getSymbolData(d.symbol);
            if(data && data.totalScore > 40) res.push(data);
        }
        rawResults = res.sort((a,b)=>b.totalScore - a.totalScore);
        render();
    }

    function render() {
        document.getElementById('list-body').innerHTML = rawResults.map(r=>`
            <tr class="${r.weight >= 20 ? 'row-strong' : (r.weight < 0 ? 'row-weak' : '')}">
                <td><span onclick="blackList.add('${r.s}');render()">âœ•</span></td>
                <td>${r.type}</td>
                <td style="font-weight:bold;">${r.s}</td>
                <td class="${r.thrustLv >= 8 ? 'lv-high' : ''}">LV ${r.thrustLv}</td>
                <td><span class="score-box ${r.totalScore>=85?'score-alert':''}">${r.totalScore}</span></td>
                <td style="color:${Math.abs(r.funding)<=0.05?'#00ffcc':''}">${r.funding.toFixed(4)}%</td>
                <td>${r.change}%</td>
            </tr>`).join('');
    }

    function toggleMonitor() {
        isMonitoring = !isMonitoring;
        document.getElementById('btn-toggle').innerText = isMonitoring ? "åœæ­¢" : "å•Ÿå‹•";
        if(isMonitoring) setInterval(startScan, 10000);
    }
</script>
</body>
</html>
