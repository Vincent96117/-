<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>HUNTER V163 | é®®è±”é–ƒçˆç‰ˆ</title>
    <style>
        /* æ•´é«”èƒŒæ™¯é®®è±”åŒ–ï¼šæ·±è—ç°æ¼¸å±¤ */
        body { background: radial-gradient(circle at top, #1a1c2c, #0d0e15); color: #e0e0e0; font-family: 'Segoe UI', sans-serif; padding: 20px; font-size: 13px; min-height: 100vh; }
        
        .header { background: rgba(30, 34, 54, 0.9); padding: 18px; border-radius: 12px; border: 1px solid #3d4465; margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.6); }
        .monitor-bar { display: flex; gap: 35px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #3d4465; }
        .index-item { display: flex; align-items: center; gap: 12px; }
        .index-name { color: #f2a900; font-weight: bold; font-size: 14px; }
        .index-price { font-family: 'Consolas', monospace; font-size: 19px; font-weight: bold; color: #ffffff; }
        
        .controls { display: flex; justify-content: space-between; align-items: center; }
        .search-group { display: flex; gap: 12px; align-items: center; }
        
        table { width: 100%; border-collapse: separate; border-spacing: 0 6px; margin-top: 10px; }
        th { background: #161925; color: #f2a900; padding: 16px; border-bottom: 2px solid #3d4465; text-transform: uppercase; }
        td { background: #1e2236; padding: 14px; text-align: center; border-top: 1px solid #2d3250; border-bottom: 1px solid #2d3250; transition: 0.3s; }
        
        /* ç³¾çµè¡Œæ•ˆæœ */
        .row-tangling td { background: #1e2c36 !important; border-top-color: #00ffcc66; border-bottom-color: #00ffcc66; }
        .row-tangling td:first-child { border-left: 5px solid #00ffcc; border-radius: 4px 0 0 4px; }

        /* æŠ€è¡“ç¸½åˆ†å‹•æ…‹é¡è‰²ï¼šå¹³æ™‚é»ƒï¼Œé80ç´…é–ƒ */
        .score-box { padding: 8px 16px; border-radius: 6px; font-weight: 900; font-size: 20px; border: 1px solid #444; display: inline-block; transition: 0.3s; }
        .score-normal { color: #f2a900; background: #2a2a2a; border-color: #f2a900; }
        .score-alert { color: #ff3e3e; background: #3a1a1a; border-color: #ff3e3e; box-shadow: 0 0 15px #ff3e3e; animation: alert-blink 0.6s infinite; }
        
        @keyframes alert-blink { 50% { opacity: 0.6; transform: scale(1.05); } }
        @keyframes blink { 50% { opacity: 0.6; } }
        .lv-high { color: #ff5252; font-weight: bold; text-shadow: 0 0 10px #ff5252; animation: blink 1s infinite; }

        /* ç‡ˆè™Ÿå–®ä½ */
        .light-bar { display: flex; justify-content: center; gap: 8px; margin-top: 8px; }
        .light-unit { display: flex; flex-direction: column; align-items: center; gap: 3px; }
        .light-label { font-size: 9px; color: #999; font-weight: bold; }
        .light { width: 16px; height: 6px; border-radius: 2px; }
        .light-green { background: #00ffcc; box-shadow: 0 0 8px #00ffcc; }
        .light-yellow { background: #f2a900; }
        .light-red { background: #ff5252; }

        .btn { border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        input { background: #2d3250; border: 1px solid #3d4465; color: #fff; padding: 10px 14px; border-radius: 8px; width: 200px; }
        input:focus { border-color: #f2a900; outline: none; }
        .del-btn { color: #666; cursor: pointer; font-size: 20px; font-weight: bold; }
        .del-btn:hover { color: #ff5252; transform: scale(1.2); }
        .info-tag { font-size: 11px; color: #aaa; display: block; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="header">
        <div class="monitor-bar">
            <div class="index-item"><span class="index-name">BTC</span><span id="btc-price" class="index-price">--</span><span id="btc-chg">--</span></div>
            <div class="index-item"><span class="index-name">ETH</span><span id="eth-price" class="index-price">--</span><span id="eth-chg">--</span></div>
        </div>
        <div class="controls">
            <div class="search-group">
                <input type="text" id="search-input" placeholder="ğŸ” æŠ“å¹£(å¦‚ SOL)..." onkeydown="if(event.key==='Enter') searchFromBinance()">
                <button class="btn" onclick="searchFromBinance()" style="background:#3d4465; color:#fff;">æœå°‹å¹£å®‰</button>
                <button id="btn-sound" class="btn" onclick="toggleSound()" style="background:#2d3250;color:#eee;">ğŸ”Š è²éŸ³: é–‹</button>
            </div>
            <button id="btn-toggle" class="btn" onclick="toggleMonitor()" style="background:#f2a900;color:#000;">å•Ÿå‹•ç›£æ§æƒæ</button>
        </div>
    </div>

    <table>
        <thead>
            <tr><th width="50">âœ•</th><th width="100">é¡å‹</th><th>å¹£ç¨® / ATRå€é–“</th><th>ğŸš€ è¡åˆºç­‰ç´š (é€Ÿåº¦/ä¸»å‹•)</th><th>æŠ€è¡“ç¸½åˆ† (æ³¢|ç³¾|é‡|è¶¨)</th><th>è³‡è²» (Â±0.05)</th><th>24H æ¼²è·Œ</th></tr>
        </thead>
        <tbody id="list-body"></tbody>
    </table>

<script>
    let isMonitoring = false, isSoundOn = true, timer = null, rawResults = [], blackList = new Set();
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function toggleSound() { isSoundOn = !isSoundOn; document.getElementById('btn-sound').innerText = isSoundOn ? "ğŸ”Š è²éŸ³: é–‹" : "ğŸ”‡ è²éŸ³: é—œ"; }
    function playBeep() {
        if (!isSoundOn) return;
        const o = audioCtx.createOscillator(), g = audioCtx.createGain();
        o.frequency.setValueAtTime(1000, audioCtx.currentTime); g.gain.setValueAtTime(0.05, audioCtx.currentTime);
        o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + 0.1);
    }

    async function updateIndex() {
        try {
            const symbols = ['BTCUSDT', 'ETHUSDT'];
            for (const s of symbols) {
                const r = await fetch(`https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=${s}`).then(res => res.json());
                const id = s.replace('USDT','').toLowerCase();
                const chg = parseFloat(r.priceChangePercent);
                document.getElementById(`${id}-price`).innerText = parseFloat(r.lastPrice).toLocaleString();
                document.getElementById(`${id}-chg`).innerText = `${chg > 0 ? '+' : ''}${chg}%`;
                document.getElementById(`${id}-chg`).style.color = chg >= 0 ? '#00ffcc' : '#ff5252';
            }
        } catch(e) {}
    }
    setInterval(updateIndex, 3000); updateIndex();

    function removeSymbol(s) {
        blackList.add(s); 
        rawResults = rawResults.filter(r => r.s !== s); 
        renderTable(); 
    }

    async function searchFromBinance() {
        let symbol = document.getElementById('search-input').value.toUpperCase().trim();
        if(!symbol) return;
        if(!symbol.endsWith('USDT')) symbol += 'USDT';
        blackList.delete(symbol);
        const res = await getSymbolData(symbol);
        if(res) {
            rawResults = [res, ...rawResults.filter(r => r.s !== symbol)];
            renderTable();
            document.getElementById('search-input').value = "";
        } else {
            alert("å¹£å®‰æ‰¾ä¸åˆ° " + symbol);
        }
    }

    function getLight(score) {
        if (score >= 25) return 'light-green';
        if (score >= 12.5) return 'light-yellow';
        return 'light-red';
    }

    async function getSymbolData(s) {
        try {
            const [tData, fRes, hK, mK] = await Promise.all([
                fetch(`https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=${s}`).then(r=>r.json()),
                fetch(`https://fapi.binance.com/fapi/v1/premiumIndex?symbol=${s}`).then(r=>r.json()),
                fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=1h&limit=25`).then(r=>r.json()),
                fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=1m&limit=60`).then(r=>r.json())
            ]);
            if(tData.code === -1121) return null;

            const now = parseFloat(hK[24][4]), hCloses = hK.map(k=>parseFloat(k[4]));
            const ma7 = hCloses.slice(-7).reduce((a,b)=>a+b,0)/7, ma25 = hCloses.slice(-25).reduce((a,b)=>a+b,0)/25;
            const ranges = hK.map(k => parseFloat(k[2]) - parseFloat(k[3])), avgR = (ranges.slice(0, 24).reduce((a,b)=>a+b,0) / 24) || 0.001;

            const s1 = Math.min(25, ((parseFloat(hK[24][2]) - parseFloat(hK[24][3]))/avgR/1.8)*25);
            const s2 = (Math.abs(ma7-ma25)/ma25*100 < 3) ? 25 : 0;
            const s3 = Math.min(25, (parseFloat(tData.quoteVolume)/45000000)*12.5);
            const s4 = (now > ma7 && ma7 > ma25) ? 25 : 0;
            const totalScore = Math.round(s1 + s2 + s3 + s4);

            const totalVol1m = parseFloat(mK[59][5]), takerVol1m = parseFloat(mK[59][9]), avgVol1m = mK.reduce((a,b)=>a+parseFloat(b[5]),0) / 60;
            const vRatio = totalVol1m / avgVol1m, buyRatio = (takerVol1m / totalVol1m) * 100;

            let thrustLv = 1;
            if (vRatio > 1.2) {
                let base = vRatio * 1.8;
                if (buyRatio > 65) base += 3; else if (buyRatio < 50) base -= 2;
                thrustLv = Math.max(2, Math.min(10, Math.round(base)));
            }

            const funding = parseFloat(fRes.lastFundingRate * 100);
            const isTangling = (funding >= -0.05 && funding <= 0.05);
            if (isMonitoring && thrustLv >= 8 && isTangling) playBeep();

            return { 
                s, totalScore, scores: [s1, s2, s3, s4], labels: ['æ³¢', 'ç³¾', 'é‡', 'è¶¨'],
                thrustLv, vRatio: vRatio.toFixed(1), buyRatio: buyRatio.toFixed(0),
                tp: ((avgR/now)*100*2.8).toFixed(1), sl: ((avgR/now)*100*2.2).toFixed(1),
                funding, change: tData.priceChangePercent, isTangling 
            };
        } catch(e) { return null; }
    }

    async function startScan() {
        if (!isMonitoring) return;
        const tData = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr').then(r=>r.json());
        let baseSymbols = tData.filter(d => d.symbol.endsWith('USDT') && parseFloat(d.quoteVolume) > 30000000).sort((a,b)=>b.quoteVolume-a.quoteVolume).slice(0, 35);
        let results = [];
        for (let d of baseSymbols) {
            if(blackList.has(d.symbol)) continue;
            const res = await getSymbolData(d.symbol);
            if (res && res.totalScore > 30) results.push(res);
        }
        rawResults = results; renderTable();
    }

    function toggleMonitor() {
        isMonitoring = !isMonitoring;
        const btn = document.getElementById('btn-toggle');
        btn.innerText = isMonitoring ? "ğŸ›‘ åœæ­¢ç›£æ§" : "å•Ÿå‹•ç›£æ§æƒæ";
        btn.style.background = isMonitoring ? "#ff5252" : "#f2a900";
        if(isMonitoring) { startScan(); timer = setInterval(startScan, 15000); } else { clearInterval(timer); }
    }

    function renderTable() {
        document.getElementById('list-body').innerHTML = rawResults.map(r => `
            <tr class="${r.isTangling ? 'row-tangling' : ''}">
                <td><span class="del-btn" onclick="removeSymbol('${r.s}')">âœ•</span></td>
                <td>${r.isTangling ? 'ğŸ’ ç³¾çµ' : 'ğŸ“Š è¶¨å‹¢'}</td>
                <td style="font-weight:bold; color:#fff;">${r.s.replace('USDT','')}<span class="info-tag">ğŸ¯ ${r.tp}% / -${r.sl}%</span></td>
                <td class="${r.thrustLv >= 8 ? 'lv-high' : ''}">LV ${r.thrustLv}<span class="info-tag">${r.vRatio}x / ${r.buyRatio}%</span></td>
                <td>
                    <span class="score-box ${r.totalScore >= 80 ? 'score-alert' : 'score-normal'}">${r.totalScore}</span>
                    <div class="light-bar">${r.scores.map((s, i) => `<div class="light-unit"><span class="light-label">${r.labels[i]}</span><div class="light ${getLight(s)}"></div></div>`).join('')}</div>
                </td>
                <td style="color:${r.isTangling ? '#00ffcc' : '#eee'}; font-weight:bold;">${r.funding.toFixed(4)}%</td>
                <td style="color:#00ffcc">${r.change}%</td>
            </tr>
        `).join('');
    }
</script>
</body>
</html>
