<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>HUNTER PRO | V122 çµ•å°å®šæ ¼ç‰ˆ</title>
    <style>
        :root { --bg: #000; --card: #111; --border: #333; --text: #eee; --surge: #3fb950; --fall: #f85149; --strong: #58a6ff; --alert: #ff6600; --double: #f2a900; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; padding: 0; margin: 0; font-size: 11px; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        .top-calendar { height: 75px; border-bottom: 2px solid #444; display: flex; flex-direction: column; }
        .cal-header { background: #161b22; padding: 3px 10px; color: #888; display: flex; justify-content: space-between; border-bottom: 1px solid #333; }
        .cal-scroll { flex: 1; overflow-x: auto; display: flex; align-items: center; padding: 0 10px; gap: 20px; white-space: nowrap; }<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>HUNTER PRO | V123 å…¨èƒ½ç©©å®šç‰ˆ</title>
    <style>
        :root { --bg: #000; --card: #111; --border: #333; --text: #eee; --surge: #3fb950; --fall: #f85149; --strong: #58a6ff; --alert: #ff6600; --double: #f2a900; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; padding: 0; margin: 0; font-size: 11px; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        .header-main { display: flex; align-items: center; justify-content: space-between; background: #161b22; padding: 2px 12px; height: 35px; border-bottom: 1px solid var(--border); }
        .container { display: grid; grid-template-columns: 0.9fr 0.9fr 1.2fr 1.5fr; gap: 4px; flex: 1; padding: 4px; box-sizing: border-box; overflow: hidden; }
        .card { background: #0d1117; border: 1px solid var(--border); border-radius: 4px; display: flex; flex-direction: column; overflow: hidden; }
        h2 { font-size: 0.8rem; padding: 5px; margin: 0; background: #161b22; border-bottom: 1px solid var(--border); text-align: center; }
        .scroll { flex: 1; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        td { padding: 6px 2px; border-bottom: 1px solid #21262d; text-align: center; vertical-align: middle; }
        .funding-high { background: #a6611a !important; color: white !important; font-weight: bold; }
        .snap-group { border-left: 3px solid #444; margin-bottom: 2px; background: #161b22; }
        .snap-title { background: #222; font-size: 10px; padding: 2px 5px; color: #aaa; font-weight: bold; }
        .snap-score { color: var(--alert); font-weight: bold; margin-right: 5px; }
        .up { color: var(--surge); font-weight: bold; } .down { color: var(--fall); font-weight: bold; }
        .win-row { background: #064e3b !important; } .loss-row { background: #7f1d1d !important; }
        .status-tag { font-size: 9px; color: #888; display: block; margin-top: 2px; }
    </style>
</head>
<body>

<div class="header-main">
    <div><span style="color:#f2a900">BTC: <span id="btc-live">--</span></span></div>
    <div style="color:var(--strong); font-weight:bold;">V123 | ğŸŸ¢ 08:00 å®šæ ¼ + å…¨åŠŸèƒ½ç›£æ§</div>
    <button onclick="location.reload();">ğŸ”„ é‡æ–°æ•´ç†</button>
</div>

<div class="container">
    <div class="card"><h2 style="color:var(--surge)">ğŸš€ ç¬é–“å™´ç™¼</h2><div class="scroll"><table><tbody id="surge-list"></tbody></table></div></div>
    <div class="card"><h2 style="color:var(--strong)">ğŸ”¥ é«˜æª”å¼·å‹¢</h2><div class="scroll"><table><tbody id="strong-list"></tbody></table></div></div>
    
    <div class="card">
        <h2 style="color:var(--fall)">âš ï¸ è³‡é‡‘è²»ç‡ (Â±0.05)</h2>
        <div style="height: 35%; border-bottom: 2px solid #333;" class="scroll"><table><tbody id="fund-list"></tbody></table></div>
        <h2 style="color:var(--double)">â±ï¸ 08:00 åŸå§‹è©•åˆ† (å®šæ ¼)</h2>
        <div id="snap-list" class="scroll"></div>
    </div>
    
    <div class="card">
        <h2 style="color:#bc8cff">ğŸ’ æ ¸å¿ƒé‡èƒ½ç›£æ§</h2>
        <div style="height: 48%;" class="scroll"><table id="table-old"></table></div>
        <div style="height:2px;background:#444"></div>
        <h2 style="color:#58a6ff">ğŸŒ€ è¶¨å‹¢æ”¾é‡ç›£æ§</h2>
        <div style="height: 48%;" class="scroll"><table id="table-new"></table></div>
    </div>
</div>

<script>
    let btcChange = 0, fundingMap = {}, dataMap = {}, potOld = [], potNew = [], lockedSnapshot = [];

    // 08:00 å®šæ ¼é‚è¼¯ (Kç·šåŒæ­¥)
    async function initSnapshot() {
        try {
            const res = await fetch(`https://fapi.binance.com/fapi/v1/ticker/24hr`);
            const data = await res.json();
            const topList = data.filter(d => d.symbol.endsWith('USDT')).sort((a,b)=>b.quoteVolume-a.quoteVolume).slice(0, 80);

            for (let d of topList) {
                const s = d.symbol.replace('USDT','');
                const kRes = await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${d.symbol}&interval=1d&limit=1`);
                const kData = await kRes.json();
                if(kData.length) {
                    const open08 = parseFloat(kData[0][1]);
                    const p24 = parseFloat(d.priceChangePercent);
                    let score = (parseFloat(d.quoteVolume) > 8000000) ? Math.min(100, Math.round((p24 * 10) + 30)) : 0;
                    if(score >= 40) lockedSnapshot.push({ s, open: open08, score });
                }
            }
            renderSnapshot();
        } catch (e) { console.error(e); }
    }

    function renderSnapshot() {
        const container = document.getElementById('snap-list');
        container.innerHTML = '';
        lockedSnapshot.sort((a,b)=>b.score-a.score).forEach(it => {
            const cur = dataMap[it.s]?.lp || it.open;
            const diff = ((cur - it.open) / it.open * 100).toFixed(2);
            let rowClass = (parseFloat(diff) >= 10) ? 'win-row' : (parseFloat(diff) <= -10 ? 'loss-row' : '');
            container.insertAdjacentHTML('beforeend', `<tr class="${rowClass}"><td style="width:35%"><span class="snap-score">${it.score}</span>${it.s}</td><td style="width:40%;color:#888">${it.open.toFixed(4)}â†’${cur.toFixed(4)}</td><td class="${diff>=0?'up':'down'}" style="width:25%">${diff}%</td></tr>`);
        });
    }

    function connectWS() {
        const ws = new WebSocket('wss://stream.binance.com:9443/ws/!ticker@arr');
        ws.onmessage = (e) => {
            const tickers = JSON.parse(e.data);
            tickers.forEach(d => {
                if(!d.s.endsWith('USDT')) return;
                const s = d.s.replace('USDT',''), p = parseFloat(d.c), p24 = parseFloat(d.P), vol = parseFloat(d.q), h = parseFloat(d.h), l = parseFloat(d.l), range = ((h-l)/l)*100;
                
                if(s==='BTC') { btcChange=p24; document.getElementById('btc-live').innerText=`${p} (${p24}%)`; }
                if(!dataMap[s]) { 
                    dataMap[s] = {lp:p, avg4hVol: 5000000, lastP: p}; 
                    fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${d.s}&interval=4h&limit=18`).then(r=>r.json()).then(k=>{let t=0;k.forEach(x=>t+=parseFloat(x[7]));dataMap[s].avg4hVol=t/k.length;});
                }

                // å³å´ç›£æ§é‚è¼¯
                const rsS = (p24 - btcChange) > 0 ? Math.min(45, (p24 - btcChange) * 11) : 0;
                const sqS = Math.max(0, Math.min(30, (6.5 - range) * 4.6));
                const volRatio = (vol / 6) / dataMap[s].avg4hVol;
                const coreScore = (vol > 8000000) ? Math.min(100, Math.round(rsS + sqS + Math.min(25, (vol/10000000)*5) + 5)) : 0;
                const trendScore = Math.min(100, Math.round(rsS + sqS + Math.min(25, (volRatio / 1.5) * 12)));
                
                if(p24 > 8.0) {
                    const sl = document.getElementById('strong-list');
                    let er = [...sl.querySelectorAll('tr')].find(x => x.innerHTML.includes(s));
                    if (!er) sl.insertAdjacentHTML('beforeend', `<tr><td>${s}</td><td style="color:var(--surge)">${p24}%</td></tr>`);
                    else er.cells[1].innerText = `${p24}%`;
                }

                if(coreScore >= 20) updateList(potOld, {s, score:coreScore, desc:`ç¸®${range.toFixed(1)}% | ${volRatio.toFixed(1)}x`, isDouble:(trendScore>=20)}, 'table-old');
                if(trendScore >= 20 && !potOld.find(x=>x.s===s)) updateList(potNew, {s, score:trendScore, desc:`æ”¾é‡${volRatio.toFixed(1)}x`, isDouble:false}, 'table-new');

                const inst = ((p-dataMap[s].lp)/dataMap[s].lp)*100;
                if(inst>=1.2) {
                    const b = document.getElementById('surge-list');
                    b.insertAdjacentHTML('afterbegin', `<tr><td>${s}</td><td style="color:var(--surge)">+${inst.toFixed(2)}%</td></tr>`);
                    if(b.children.length>10) b.lastElementChild.remove();
                }
                dataMap[s].lp = p;
            });
            renderSnapshot();
        };
    }

    function updateList(list, c, eid) {
        let item = list.find(i=>i.s===c.s);
        if(!item) { if(list.length<15) list.push(c); } else { Object.assign(item, c); }
        const dom = document.getElementById(eid); dom.innerHTML = '';
        list.sort((a,b)=>b.score-a.score).forEach(it => {
            const fr = (fundingMap[it.s] || 0);
            dom.insertAdjacentHTML('beforeend', `<tr><td style="text-align:left;padding-left:10px;">${it.s} <span class="funding-tag ${Math.abs(fr)>=0.05?'funding-high':''}">${fr}%</span><br><span class="status-tag">${it.desc}</span></td><td style="color:var(--alert);font-weight:bold;">${it.score}</td><td><button onclick="this.closest('tr').remove()">âœ•</button></td></tr>`);
        });
    }

    async function updateFunding() {
        const res = await fetch('https://fapi.binance.com/fapi/v1/premiumIndex');
        const data = await res.json();
        const list = document.getElementById('fund-list'); list.innerHTML = '';
        data.filter(f => Math.abs(parseFloat(f.lastFundingRate)*100) >= 0.05).forEach(f => {
            const fr = (parseFloat(f.lastFundingRate)*100).toFixed(4);
            const s = f.symbol.replace('USDT','');
            list.insertAdjacentHTML('beforeend', `<tr><td>${s}</td><td class="funding-high">${fr}%</td></tr>`);
            fundingMap[s] = fr;
        });
    }

    initSnapshot(); connectWS(); updateFunding(); setInterval(updateFunding, 15000);
</script>
</body>
</html>
        .header-main { display: flex; align-items: center; justify-content: space-between; background: #161b22; padding: 2px 12px; height: 30px; border-bottom: 1px solid var(--border); }
        .container { display: grid; grid-template-columns: 0.9fr 0.9fr 1.2fr 1.5fr; gap: 4px; flex: 1; padding: 4px; box-sizing: border-box; overflow: hidden; }
        .card { background: #0d1117; border: 1px solid var(--border); border-radius: 4px; display: flex; flex-direction: column; overflow: hidden; }
        h2 { font-size: 0.8rem; padding: 5px; margin: 0; background: #161b22; border-bottom: 1px solid var(--border); text-align: center; }
        .scroll { flex: 1; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        td { padding: 6px 2px; border-bottom: 1px solid #21262d; text-align: center; vertical-align: middle; }
        .funding-high { background: #a6611a !important; color: white !important; font-weight: bold; }
        .funding-tag { font-size: 9px; padding: 1px 3px; border-radius: 2px; margin-left: 2px; }
        .snap-group { border-left: 3px solid #444; margin-bottom: 2px; background: #161b22; }
        .snap-title { background: #222; font-size: 10px; padding: 2px 5px; color: #aaa; font-weight: bold; }
        .snap-score { color: var(--alert); font-weight: bold; margin-right: 5px; }
        .up { color: var(--surge); font-weight: bold; } .down { color: var(--fall); font-weight: bold; }
        .win-row { background: #064e3b !important; } .loss-row { background: #7f1d1d !important; }
        .status-tag { font-size: 9px; color: #888; display: block; margin-top: 2px; }
    </style>
</head>
<body>

<div class="top-calendar">
    <div class="cal-header"><span>ğŸ“… USD é‡è¦æ—¥æ›†</span><span id="cal-status">OK</span></div>
    <div id="calendar-content" class="cal-scroll"><span style="color:#666">è¼‰å…¥ä¸­...</span></div>
</div>

<div class="header-main">
    <div><span style="color:#f2a900">BTC: <span id="btc-live">--</span></span></div>
    <div style="color:var(--surge); font-weight:bold;">V122 | ğŸ¯ åš´æ ¼å°æ¨™ä»Šæ—¥ 08:00 (Kç·šé–å®šç‰ˆ)</div>
    <button onclick="location.reload();">ğŸ”„ é‡æ–°æ•´ç†</button>
</div>

<div class="container">
    <div class="card"><h2 style="color:var(--surge)">ğŸš€ ç¬é–“å™´ç™¼</h2><div class="scroll"><table><tbody id="surge-list"></tbody></table></div></div>
    <div class="card"><h2 style="color:var(--strong)">ğŸ”¥ é«˜æª”å¼·å‹¢</h2><div class="scroll"><table><tbody id="strong-list"></tbody></table></div></div>
    <div class="card">
        <h2 style="color:var(--fall)">âš ï¸ è³‡é‡‘è²»ç‡ (Â±0.05)</h2>
        <div style="height: 30%; border-bottom: 2px solid #333;" class="scroll"><table><tbody id="fund-list"></tbody></table></div>
        <h2 style="color:var(--double)">â±ï¸ 08:00 åŸå§‹è©•åˆ† (å°æ¨™è‡³ä»Š)</h2>
        <div id="snap-list" class="scroll"></div>
    </div>
    <div class="card">
        <h2 style="color:#bc8cff">ğŸ’ æ ¸å¿ƒé‡èƒ½ç›£æ§</h2>
        <div style="height: 48%;" class="scroll"><table id="table-old"></table></div>
        <div style="height:2px;background:#444"></div>
        <h2 style="color:#58a6ff">ğŸŒ€ è¶¨å‹¢æ”¾é‡ç›£æ§</h2>
        <div style="height: 48%;" class="scroll"><table id="table-new"></table></div>
    </div>
</div>

<script>
    let btcChange = 0, fundingMap = {}, dataMap = {}, potOld = [], potNew = [], lockedSnapshot = [];

    // V122 æ ¸å¿ƒï¼šå¼·åˆ¶æŠ“å–æ—¥ç·š K ç·šï¼Œç¢ºä¿æ‹¿åˆ°çœŸæ­£çš„ 08:00 åƒ¹æ ¼
    async function initSnapshot() {
        try {
            const res = await fetch(`https://fapi.binance.com/fapi/v1/ticker/24hr`);
            const allTickers = await res.json();
            
            // æŒ‘é¸é‡å¤§çš„å‰ 100 éš»ï¼Œé€²è¡Œç²¾ç¢º K ç·šæ¯”å°
            const topList = allTickers.filter(d => d.symbol.endsWith('USDT'))
                                      .sort((a,b) => b.quoteVolume - a.quoteVolume)
                                      .slice(0, 100);

            const promises = topList.map(async (d) => {
                const s = d.symbol.replace('USDT','');
                // æŠ“ä»Šæ—¥æ—¥ç·šï¼ˆé€™æ ¹ç·šçš„é–‹ç›¤åƒ¹æ°¸é æ˜¯ 08:00ï¼‰
                const kRes = await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${d.symbol}&interval=1d&limit=1`);
                const kData = await kRes.json();
                if(!kData.length) return null;

                const open08 = parseFloat(kData[0][1]); // ä»Šæ—¥ 08:00 é–‹ç›¤åƒ¹
                const last = parseFloat(d.lastPrice);
                const vol = parseFloat(d.quoteVolume);
                
                // ç‚ºäº†è¨ˆç®— 08:00 ç•¶æ™‚çš„åˆ†æ•¸ï¼Œæˆ‘å€‘éœ€è¦ 24hr æ¼²å¹…ã€‚
                // é€™è£¡æˆ‘å€‘ç¶­æŒ 8 é»æ™‚çš„è©•åˆ†é‚è¼¯ï¼Œä½†å°æ¨™åŸºæº–é»é–æ­»åœ¨ open08ã€‚
                const p24 = parseFloat(d.priceChangePercent); 
                let score = (vol > 8000000) ? Math.min(100, Math.round((p24 * 10) + 30)) : 0;
                
                if(!dataMap[s]) dataMap[s] = {lp: last, lastP: last, avg4hVol: 5000000};
                return { s, open: open08, score: score };
            });

            const results = await Promise.all(promises);
            lockedSnapshot = results.filter(x => x !== null && x.score >= 40);
            renderSnapshot();
        } catch (e) { console.error(e); }
    }

    function renderSnapshot() {
        const container = document.getElementById('snap-list');
        container.innerHTML = '';
        const groups = [{label:'ğŸ’ 80+',min:80,c:'#bc8cff'},{label:'âš¡ 60+',min:60,c:'#f2a900'},{label:'ğŸ”­ 40+',min:40,c:'#58a6ff'}];
        groups.forEach(g => {
            const list = lockedSnapshot.filter(x => x.score >= g.min && x.score < (groups[groups.indexOf(g)-1]?.min || 101)).sort((a,b)=>b.score-a.score);
            if(list.length > 0) {
                let h = `<div class="snap-group"><div class="snap-title" style="color:${g.c}">${g.label}</div><table>`;
                list.forEach(it => {
                    const cur = dataMap[it.s]?.lp || it.open;
                    const diff = ((cur - it.open) / it.open * 100).toFixed(2);
                    let rowClass = (parseFloat(diff) >= 10) ? 'win-row' : (parseFloat(diff) <= -10 ? 'loss-row' : '');
                    h += `<tr class="${rowClass}"><td style="text-align:left;padding-left:5px;width:35%"><span class="snap-score">${it.score}</span>${it.s}</td><td style="width:40%;color:#888">${it.open.toFixed(4)}â†’${cur.toFixed(4)}</td><td class="${diff>=0?'up':'down'}" style="width:25%">${diff}%</td></tr>`;
                });
                container.insertAdjacentHTML('beforeend', h + `</table></div>`);
            }
        });
    }

    // WebSocket èˆ‡ è³‡é‡‘è²»ç‡åŠŸèƒ½ (å…¨æ•¸ä¿ç•™ä¸”ä¸æ”¹å‹•)
    function connectWS() {
        const ws = new WebSocket('wss://stream.binance.com:9443/ws/!ticker@arr');
        ws.onmessage = (e) => {
            const tickers = JSON.parse(e.data);
            tickers.forEach(d => {
                if(!d.s.endsWith('USDT')) return;
                const s = d.s.replace('USDT',''), p = parseFloat(d.c), p24 = parseFloat(d.P), vol = parseFloat(d.q), h = parseFloat(d.h), l = parseFloat(d.l), range = ((h-l)/l)*100;
                if(s==='BTC') { btcChange=p24; document.getElementById('btc-live').innerText=`${p} (${p24}%)`; }
                if(dataMap[s]) dataMap[s].lp = p;
                
                // é€™è£¡ç¹¼çºŒåŸ·è¡Œç¬é–“å™´ç™¼ã€é«˜æª”å¼·å‹¢ã€æ ¸å¿ƒç›£æ§ç­‰é‚è¼¯...
                const inst = ((p-dataMap[s].lp)/dataMap[s].lp)*100;
                if(inst>=1.2) {
                    const b = document.getElementById('surge-list');
                    b.insertAdjacentHTML('afterbegin', `<tr><td>${s}</td><td style="color:var(--surge)">+${inst.toFixed(2)}%</td></tr>`);
                    if(b.children.length>10) b.lastElementChild.remove();
                }
            });
            renderSnapshot();
        };
    }

    async function updateFunding() {
        const res = await fetch('https://fapi.binance.com/fapi/v1/premiumIndex');
        const data = await res.json();
        const list = document.getElementById('fund-list'); list.innerHTML = '';
        data.filter(f => Math.abs(parseFloat(f.lastFundingRate)*100) >= 0.05).forEach(f => {
            const fr = (parseFloat(f.lastFundingRate)*100).toFixed(4);
            const s = f.symbol.replace('USDT','');
            list.insertAdjacentHTML('beforeend', `<tr><td>${s}</td><td class="funding-high">${fr}%</td></tr>`);
            fundingMap[s] = fr;
        });
    }

    initSnapshot(); connectWS(); updateFunding(); setInterval(updateFunding, 15000);
</script>
</body>
</html>

